/*!
 * vwo-fme-node-sdk - v1.20.2
 * URL - https://github.com/wingify/vwo-node-sdk
 *
 * Copyright 2024-2025 Wingify Software Pvt. Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Dependencies used -
 *  1. murmurhash - ^2.0.1
 *  2. superstruct - ^0.14.x
 *  3. uuid - ^9.0.1
 *  4. vwo-fme-sdk-log-messages - ^1.*.*
 */
(()=>{"use strict";var e={119:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkManager=void 0;var r=n(5576),o=n(9717),a=n(7666),i=function(){function e(){}return e.prototype.attachClient=function(e){if(void 0===process.env)if("undefined"==typeof XMLHttpRequest){var t=n(8341).w;this.client=e||new t}else{var r=n(7005).o;this.client=e||new r}else{var o=n(6787)._;this.client=e||new o}this.config=new a.GlobalRequestModel(null,null,null,null)},Object.defineProperty(e,"Instance",{get:function(){return this.instance=this.instance||new e,this.instance},enumerable:!1,configurable:!0}),e.prototype.setConfig=function(e){this.config=e},e.prototype.getConfig=function(){return this.config},e.prototype.createRequest=function(e){return(new o.RequestHandler).createRequest(e,this.config)},e.prototype.get=function(e){var t=new r.Deferred,n=this.createRequest(e);return n.getUrl()?this.client.GET(n).then((function(e){t.resolve(e)})).catch((function(e){t.reject(e)})):t.reject(new Error("no url found")),t.promise},e.prototype.post=function(e){var t=new r.Deferred,n=this.createRequest(e);return n.getUrl()?this.client.POST(n).then((function(e){t.resolve(e)})).catch((function(e){t.reject(e)})):t.reject(new Error("no url found")),t.promise},e}();t.NetworkManager=i},477:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Constants=void 0;var r,o,a=n(2550),i=n(3388);void 0===process.env?(r={name:"vwo-fme-javascript-sdk",version:SDK_VERSION},o=a.PlatformEnum.CLIENT):(r=n(6089),o=a.PlatformEnum.SERVER),t.Constants={SDK_NAME:r.name,SDK_VERSION:r.version,PLATFORM:o,MAX_TRAFFIC_PERCENT:100,MAX_TRAFFIC_VALUE:1e4,STATUS_RUNNING:"RUNNING",SEED_VALUE:1,MAX_EVENTS_PER_REQUEST:5e3,DEFAULT_REQUEST_TIME_INTERVAL:600,DEFAULT_EVENTS_PER_REQUEST:100,SEED_URL:i.SEED_URL,HTTP_PROTOCOL:i.HTTP_PROTOCOL,HTTPS_PROTOCOL:i.HTTPS_PROTOCOL,SETTINGS:"settings",SETTINGS_EXPIRY:1e7,SETTINGS_TIMEOUT:5e4,SETTINGS_TTL:72e5,MIN_TTL_MS:6e4,HOST_NAME:"dev.visualwebsiteoptimizer.com",SETTINTS_ENDPOINT:"/server-side/v2-settings",WEBHOOK_SETTINTS_ENDPOINT:"/server-side/v2-pull",LOCATION_ENDPOINT:"/getLocation",VWO_FS_ENVIRONMENT:"vwo_fs_environment",RANDOM_ALGO:1,API_VERSION:"1",VWO_META_MEG_KEY:"_vwo_meta_meg_",MAX_RETRIES:3,RETRY_DELAY:1e3,DEFAULT_LOCAL_STORAGE_KEY:"vwo_fme_data",DEFAULT_SETTINGS_STORAGE_KEY:"vwo_fme_settings"}},596:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.getFromGatewayService=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a;return o(this,(function(o){if(n=new g.Deferred,r=c.NetworkManager.Instance,!l.SettingsService.Instance.isGatewayServiceProvided)return u.LogManager.Instance.error(s.ErrorLogMessagesEnum.GATEWAY_URL_ERROR),n.resolve(!1),[2,n.promise];e.accountId=l.SettingsService.Instance.accountId;try{return a=new c.RequestModel(p.UrlUtil.getBaseUrl(),i.HttpMethodEnum.GET,t,e,null,null,l.SettingsService.Instance.protocol,l.SettingsService.Instance.port),r.get(a).then((function(e){n.resolve(e.getData())})).catch((function(e){n.reject(e)})),[2,n.promise]}catch(e){return n.resolve(!1),[2,n.promise]}return[2]}))}))},t.getQueryParams=function(e){for(var t={},n=0,r=Object.entries(e);n<r.length;n++){var o=r[n],a=o[0],i=o[1],s=encodeURIComponent(String(i));t[a]=s}return t},t.addIsGatewayServiceRequiredFlag=function(e){for(var t=/\b(?<!"custom_variable"[^}]*)(country|region|city|os|device_type|browser_string|ua)\b|(?<="custom_variable"\s*:\s*{\s*"name"\s*:\s*")inlist\([^)]*\)(?=")/g,n=0,r=e.getFeatures();n<r.length;n++)for(var o=r[n],i=0,s=o.getRulesLinkedCampaign();i<s.length;i++){var u,c=s[i];if(u=c.getType()===a.CampaignTypeEnum.PERSONALIZE||c.getType()===a.CampaignTypeEnum.ROLLOUT?c.getVariations()[0].getSegments():c.getSegments()){var l=JSON.stringify(u).match(t);if(l&&l.length>0){o.setIsGatewayServiceRequired(!0);break}}}};var a=n(6947),i=n(5212),s=n(2974),u=n(6178),c=n(4464),l=n(9600),g=n(5576),p=n(6096)},689:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateRule=void 0;var a=n(7173),i=n(9455),s=n(1943),u=n(9284);t.evaluateRule=function(e,t,n,c,l,g,p,d){return r(void 0,void 0,void 0,(function(){var r,f,h;return o(this,(function(o){switch(o.label){case 0:return[4,(0,i.checkWhitelistingAndPreSeg)(e,t,n,c,l,g,p,d)];case 1:return r=o.sent(),f=r[0],h=r[1],f&&(0,a.isObject)(h)&&Object.keys(h).length>0?(Object.assign(d,{experimentId:n.getId(),experimentKey:n.getKey(),experimentVariationId:h.variationId}),(0,s.getShouldWaitForTrackingCalls)()?[4,(0,u.createAndSendImpressionForVariationShown)(e,n.getId(),h.variation.id,c)]:[3,3]):[3,4];case 2:return o.sent(),[3,4];case 3:(0,u.createAndSendImpressionForVariationShown)(e,n.getId(),h.variation.id,c),o.label=4;case 4:return[2,{preSegmentationResult:f,whitelistedObject:h,updatedDecision:d}]}}))}))}},834:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.StorageDecorator=void 0;var a=n(6178),i=n(1522),s=n(2974),u=n(5076),c=n(5576),l=function(){function e(){}return e.prototype.getFeatureFromStorage=function(e,t,n){return r(this,void 0,void 0,(function(){var r;return o(this,(function(o){return r=new c.Deferred,n.getDataInStorage(e,t).then((function(e){switch(e){case i.StorageEnum.STORAGE_UNDEFINED:case i.StorageEnum.NO_DATA_FOUND:r.resolve(null);break;case i.StorageEnum.INCORRECT_DATA:r.resolve(i.StorageEnum.INCORRECT_DATA);break;case i.StorageEnum.CAMPAIGN_PAUSED:r.resolve(null);break;case i.StorageEnum.VARIATION_NOT_FOUND:r.resolve(i.StorageEnum.VARIATION_NOT_FOUND);break;case i.StorageEnum.WHITELISTED_VARIATION:r.resolve(null);break;default:r.resolve(e)}})),[2,r.promise]}))}))},e.prototype.setDataInStorage=function(e,t){var n=new c.Deferred,r=e.featureKey,o=e.context,i=e.rolloutId,l=e.rolloutKey,g=e.rolloutVariationId,p=e.experimentId,d=e.experimentKey,f=e.experimentVariationId;return r?o.id?!l||d||g?d&&!f?(a.LogManager.Instance.error((0,u.buildMessage)(s.ErrorLogMessagesEnum.STORING_DATA_ERROR,{key:"Variation:(experimentKey or rolloutVariationId)"})),void n.reject()):(t.setDataInStorage({featureKey:r,userId:o.id,rolloutId:i,rolloutKey:l,rolloutVariationId:g,experimentId:p,experimentKey:d,experimentVariationId:f}),n.resolve(),n.promise):(a.LogManager.Instance.error((0,u.buildMessage)(s.ErrorLogMessagesEnum.STORING_DATA_ERROR,{key:"Variation:(rolloutKey, experimentKey or rolloutVariationId)"})),void n.reject()):(a.LogManager.Instance.error((0,u.buildMessage)(s.ErrorLogMessagesEnum.STORING_DATA_ERROR,{key:"Context or Context.id"})),void n.reject()):(a.LogManager.Instance.error((0,u.buildMessage)(s.ErrorLogMessagesEnum.STORING_DATA_ERROR,{key:"featureKey"})),void n.reject())},e}();t.StorageDecorator=l},976:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MetricModel=void 0;var n=function(){function e(){}return e.prototype.modelFromDictionary=function(e){return this.identifier=e.identifier||e.key,this.id=e.i||e.id,this.type=e.t||e.type,this},e.prototype.getId=function(){return this.id},e.prototype.getIdentifier=function(){return this.identifier},e.prototype.getType=function(){return this.type},e}();t.MetricModel=n},1007:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserStorageConnector=void 0;var i=n(477),s=n(5576),u=n(6178),c=n(9600),l=n(5600),g=n(7173),p=function(){function e(e){this.SETTINGS_KEY=i.Constants.DEFAULT_SETTINGS_STORAGE_KEY,this.storageKey=(null==e?void 0:e.key)||i.Constants.DEFAULT_LOCAL_STORAGE_KEY,this.storage=(null==e?void 0:e.provider)||window.localStorage,this.isDisabled=(null==e?void 0:e.isDisabled)||!1,this.alwaysUseCachedSettings=(null==e?void 0:e.alwaysUseCachedSettings)||!1,!(0,g.isNumber)(null==e?void 0:e.ttl)||e.ttl<i.Constants.MIN_TTL_MS?(u.LogManager.Instance.debug("TTL is not passed or invalid (less than 1 minute), using default value of 2 hours"),this.ttl=i.Constants.SETTINGS_TTL):this.ttl=(null==e?void 0:e.ttl)||i.Constants.SETTINGS_TTL,(0,g.isBoolean)(null==e?void 0:e.alwaysUseCachedSettings)?this.alwaysUseCachedSettings=(null==e?void 0:e.alwaysUseCachedSettings)||!1:(u.LogManager.Instance.debug("AlwaysUseCachedSettings is not passed or invalid, using default value of false"),this.alwaysUseCachedSettings=!1)}return e.prototype.getStoredData=function(){if(this.isDisabled)return{};try{var e=this.storage.getItem(this.storageKey);return e?JSON.parse(e):{}}catch(e){return u.LogManager.Instance.error("Error reading from storage: ".concat(e)),{}}},e.prototype.storeData=function(e){if(!this.isDisabled)try{var t=JSON.stringify(e);this.storage.setItem(this.storageKey,t)}catch(e){u.LogManager.Instance.error("Error writing to storage: ".concat(e))}},e.prototype.set=function(e){var t=new s.Deferred;if(this.isDisabled)t.resolve();else try{var n=this.getStoredData(),r="".concat(e.featureKey,"_").concat(e.userId);n[r]=e,this.storeData(n),u.LogManager.Instance.info("Stored data in storage for key: ".concat(r)),t.resolve()}catch(e){u.LogManager.Instance.error("Error storing data: ".concat(e)),t.reject(e)}return t.promise},e.prototype.get=function(e,t){var n,r=new s.Deferred;if(this.isDisabled)r.resolve({});else try{var o=this.getStoredData(),a="".concat(e,"_").concat(t),i=null!==(n=o[a])&&void 0!==n?n:{};u.LogManager.Instance.info("Retrieved data from storage for key: ".concat(a)),r.resolve(i)}catch(e){u.LogManager.Instance.error("Error retrieving data: ".concat(e)),r.resolve({})}return r.promise},e.prototype.getSettingsFromStorage=function(e,t){var n,r=new s.Deferred;if(this.isDisabled)r.resolve(null);else try{var o=this.getStoredData()[this.SETTINGS_KEY];if(!o)return r.resolve(null),r.promise;var a=o.data,i=o.timestamp,c=Date.now();if(a&&a.sdkKey)try{a.sdkKey=atob(a.sdkKey)}catch(e){u.LogManager.Instance.error("Failed to decode sdkKey from storage")}if(!a||a.sdkKey!==e||String(null!==(n=a.accountId)&&void 0!==n?n:a.a)!==String(t))return u.LogManager.Instance.info("Cached settings do not match sdkKey/accountId, treating as cache miss"),r.resolve(null),r.promise;if(this.alwaysUseCachedSettings)return u.LogManager.Instance.info("Using cached settings as alwaysUseCachedSettings is enabled"),r.resolve(a),r.promise;if(c-i>this.ttl)u.LogManager.Instance.info("Settings have expired, need to fetch new settings"),r.resolve(null);else{if(u.LogManager.Instance.info("Retrieved valid settings from storage"),this.setFreshSettingsInStorage(),a&&a.sdkKey)try{a.sdkKey=atob(a.sdkKey)}catch(e){u.LogManager.Instance.error("Failed to decode sdkKey from storage")}r.resolve(a)}}catch(e){u.LogManager.Instance.error("Error retrieving settings: ".concat(e)),r.resolve(null)}return r.promise},e.prototype.setFreshSettingsInStorage=function(){var e=this,t=c.SettingsService.Instance;t&&t.fetchSettings().then((function(t){return o(e,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return t&&(new l.SettingsSchema).isSettingsValid(t)?[4,this.setSettingsInStorage(t)]:[3,2];case 1:e.sent(),u.LogManager.Instance.info("Settings updated with fresh data from server"),e.label=2;case 2:return[2]}}))}))})).catch((function(e){u.LogManager.Instance.error("Error fetching fresh settings: ".concat(e))}))},e.prototype.setSettingsInStorage=function(e){var t=new s.Deferred;if(this.isDisabled)t.resolve();else try{var n=this.getStoredData(),o=r({},e);o.sdkKey&&(o.sdkKey=btoa(o.sdkKey)),n[this.SETTINGS_KEY]={data:o,timestamp:Date.now()},this.storeData(n),u.LogManager.Instance.info("Settings stored successfully in storage"),t.resolve()}catch(e){u.LogManager.Instance.error("Error storing settings: ".concat(e)),t.reject(e)}return t.promise},e}();t.BrowserStorageConnector=p},1155:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.StatusEnum=void 0,function(e){e.PASSED="passed",e.FAILED="failed"}(n||(t.StatusEnum=n={}))},1202:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LogTransportManager=t.LogLevelNumberEnum=void 0;var r,o=n(8858),a=n(7846),i=n(7173);!function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR"}(r||(t.LogLevelNumberEnum=r={}));var s=function(){function e(e){this.transports=[],this.config=e}return e.prototype.addTransport=function(e){this.transports.push(e)},e.prototype.shouldLog=function(e,t){return r[e.toUpperCase()]>=r[(t||this.config.level).toUpperCase()]},e.prototype.trace=function(e){this.log(o.LogLevelEnum.TRACE,e)},e.prototype.debug=function(e){this.log(o.LogLevelEnum.DEBUG,e)},e.prototype.info=function(e){this.log(o.LogLevelEnum.INFO,e)},e.prototype.warn=function(e){this.log(o.LogLevelEnum.WARN,e)},e.prototype.error=function(e){this.log(o.LogLevelEnum.ERROR,e)},e.prototype.log=function(e,t){for(var n=0;n<this.transports.length;n++){var r=new a.LogMessageBuilder(this.config,this.transports[n]).formatMessage(e,t);this.shouldLog(e,this.transports[n].level)&&(this.transports[n].log&&(0,i.isFunction)(this.transports[n].log)?this.transports[n].log(e,t):this.transports[n][e](r))}},e}();t.LogTransportManager=s},1463:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VariationModel=void 0;var r=n(2160),o=function(){function e(){this.variables=[],this.variations=[]}return e.prototype.modelFromDictionary=function(t){var n=this;return this.id=t.i||t.id,this.key=t.n||t.key||t.name,this.weight=t.w||t.weight,this.ruleKey=t.ruleKey,this.salt=t.salt,this.type=t.type,this.setStartRange(t.startRangeVariation),this.setEndRange(t.endRangeVariation),(t.seg||t.segments)&&(this.segments=t.seg||t.segments),t.variables&&(t.variables.constructor==={}.constructor?this.variables=[]:t.variables.forEach((function(e){n.variables.push(r.VariableModel.modelFromDictionary(e))}))),t.variations&&(t.variations.constructor==={}.constructor?this.variations=[]:t.variations.forEach((function(t){n.variations.push((new e).modelFromDictionary(t))}))),this},e.prototype.setStartRange=function(e){this.startRangeVariation=e},e.prototype.setEndRange=function(e){this.endRangeVariation=e},e.prototype.setWeight=function(e){this.weight=e},e.prototype.getId=function(){return this.id},e.prototype.getKey=function(){return this.key},e.prototype.getRuleKey=function(){return this.ruleKey},e.prototype.getWeight=function(){return this.weight},e.prototype.getSegments=function(){return this.segments},e.prototype.getStartRangeVariation=function(){return this.startRangeVariation},e.prototype.getEndRangeVariation=function(){return this.endRangeVariation},e.prototype.getVariables=function(){return this.variables},e.prototype.getVariations=function(){return this.variations},e.prototype.getType=function(){return this.type},e.prototype.getSalt=function(){return this.salt},e}();t.VariationModel=o},1522:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.StorageEnum=void 0,function(e){e[e.STORAGE_UNDEFINED=0]="STORAGE_UNDEFINED",e[e.INCORRECT_DATA=1]="INCORRECT_DATA",e[e.NO_DATA_FOUND=2]="NO_DATA_FOUND",e[e.CAMPAIGN_PAUSED=3]="CAMPAIGN_PAUSED",e[e.VARIATION_NOT_FOUND=4]="VARIATION_NOT_FOUND",e[e.WHITELISTED_VARIATION=5]="WHITELISTED_VARIATION"}(n||(t.StorageEnum=n={}))},1566:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.StorageService=void 0;var a=n(1522),i=n(4059),s=n(2974),u=n(6178),c=n(7173),l=n(5076),g=n(5576),p=function(){function e(){this.storageData={}}return e.prototype.getDataInStorage=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return o(this,(function(o){return n=new g.Deferred,r=i.Storage.Instance.getConnector(),(0,c.isNull)(r)||(0,c.isUndefined)(r)?n.resolve(a.StorageEnum.STORAGE_UNDEFINED):r.get(e,t.getId()).then((function(e){n.resolve(e)})).catch((function(e){u.LogManager.Instance.error((0,l.buildMessage)(s.ErrorLogMessagesEnum.STORED_DATA_ERROR,{err:e})),n.resolve(a.StorageEnum.NO_DATA_FOUND)})),[2,n.promise]}))}))},e.prototype.setDataInStorage=function(e){return r(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){return t=new g.Deferred,null==(n=i.Storage.Instance.getConnector())?t.resolve(!1):n.set(e).then((function(){t.resolve(!0)})).catch((function(){t.resolve(!1)})),[2,t.promise]}))}))},e}();t.StorageService=p},1913:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sendGetCall=function(e){return a(r.HttpMethodEnum.GET,e)},t.sendPostCall=function(e){return a(r.HttpMethodEnum.POST,e)};var r=n(5212),o=n(8470);function a(e,t){var n="".concat(t.scheme,"://").concat(t.hostname).concat(t.path);return new Promise((function(a,i){e===r.HttpMethodEnum.POST&&(t.body=JSON.stringify(t.body)),fetch(n,t).then((function(t){return t.text().then((function(n){var s={};try{s=e===r.HttpMethodEnum.GET?JSON.parse(n):n}catch(e){console.info("VWO-SDK - [INFO]: ".concat((0,o.getCurrentTime)()," VWO didn't send JSON response which is expected: ").concat(e))}if(200===t.status)a(s);else{var u="";e===r.HttpMethodEnum.GET?u="VWO-SDK - [ERROR]: ".concat((0,o.getCurrentTime)()," Request failed for fetching account settings. Got Status Code: ").concat(t.status):e===r.HttpMethodEnum.POST&&(u="VWO-SDK - [ERROR]: ".concat((0,o.getCurrentTime)()," Request failed while making a POST request. Got Status Code: ").concat(t.status)),console.error(u),i(u)}}))})).catch((function(t){var n="";e===r.HttpMethodEnum.GET?n="VWO-SDK - [ERROR]: ".concat((0,o.getCurrentTime)()," GET request failed for fetching account settings. Error: ").concat(t):e===r.HttpMethodEnum.POST&&(n="VWO-SDK - [ERROR]: ".concat((0,o.getCurrentTime)()," POST request failed while sending data. Error: ").concat(t)),console.error(n),i(n)}))}))}},1943:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.getSettingsPath=function(e,t){return{i:"".concat(e),r:Math.random(),a:t}},t.getTrackEventPath=function(e,t,n){return{event_type:e,account_id:t,uId:n,u:(0,i.getUUID)(n,t),sdk:s.Constants.SDK_NAME,"sdk-v":s.Constants.SDK_VERSION,random:(0,a.getRandomNumber)(),ap:s.Constants.PLATFORM,sId:(0,a.getCurrentUnixTimestamp)(),ed:JSON.stringify({p:"server"})}},t.getEventsBaseProperties=function(e,t,n){void 0===t&&(t=""),void 0===n&&(n="");var r=f.SettingsService.Instance.sdkKey,o=Object.assign({en:e,a:f.SettingsService.Instance.accountId,env:r,eTime:(0,a.getCurrentUnixTimestampInMillis)(),random:(0,a.getRandomNumber)(),p:"FS",visitor_ua:t,visitor_ip:n});return o.url=s.Constants.HTTPS_PROTOCOL+m.UrlUtil.getBaseUrl()+l.UrlEnum.EVENTS,o},t._getEventBasePayload=I,t.getTrackUserPayloadData=function(e,t,n,r,o,a,i){void 0===a&&(a=""),void 0===i&&(i="");var s=I(0,t,n,a,i);return s.d.event.props.id=r,s.d.event.props.variation=o,s.d.event.props.isFirst=1,Object.keys(b.UsageStatsUtil.getInstance().getUsageStats()).length>0&&(s.d.event.props.vwoMeta=b.UsageStatsUtil.getInstance().getUsageStats()),p.LogManager.Instance.debug((0,v.buildMessage)(g.DebugLogMessagesEnum.IMPRESSION_FOR_TRACK_USER,{accountId:e.getAccountId(),userId:t,campaignId:r})),s},t.getTrackGoalPayloadData=function(e,t,n,r,o,a){void 0===o&&(o=""),void 0===a&&(a="");var i=I(0,t,n,o,a);if(i.d.event.props.isCustomEvent=!0,i.d.event.props.variation=1,i.d.event.props.id=1,r&&(0,h.isObject)(r)&&Object.keys(r).length>0)for(var s in r)i.d.event.props[s]=r[s];return p.LogManager.Instance.debug((0,v.buildMessage)(g.DebugLogMessagesEnum.IMPRESSION_FOR_TRACK_GOAL,{eventName:n,accountId:e.getAccountId(),userId:t})),i},t.getAttributePayloadData=function(e,t,n,r,o,a){void 0===o&&(o=""),void 0===a&&(a="");var i=I(0,t,n,o,a);i.d.event.props.isCustomEvent=!0,i.d.event.props[s.Constants.VWO_FS_ENVIRONMENT]=e.getSdkkey();for(var u=0,c=Object.entries(r);u<c.length;u++){var l=c[u],d=l[0],f=l[1];i.d.visitor.props[d]=f}return p.LogManager.Instance.debug((0,v.buildMessage)(g.DebugLogMessagesEnum.IMPRESSION_FOR_SYNC_VISITOR_PROP,{eventName:n,accountId:e.getAccountId(),userId:t})),i},t.sendPostApiRequest=function(e,t,n){return r(this,void 0,void 0,(function(){var r,a,i,s,y;return o(this,(function(o){switch(o.label){case 0:return d.NetworkManager.Instance.attachClient(),r={},a=t.d.visitor_ua,i=t.d.visitor_ip,a&&(r[u.HeadersEnum.USER_AGENT]=a),i&&(r[u.HeadersEnum.IP]=i),s=m.UrlUtil.getBaseUrl(),s=m.UrlUtil.getUpdatedBaseUrl(s),y=new d.RequestModel(s,c.HttpMethodEnum.POST,l.UrlEnum.EVENTS,e,t,r,f.SettingsService.Instance.protocol,f.SettingsService.Instance.port),[4,d.NetworkManager.Instance.post(y).then((function(){Object.keys(b.UsageStatsUtil.getInstance().getUsageStats()).length>0&&b.UsageStatsUtil.getInstance().clearUsageStats(),p.LogManager.Instance.info((0,v.buildMessage)(g.InfoLogMessagesEnum.NETWORK_CALL_SUCCESS,{event:e.en,endPoint:l.UrlEnum.EVENTS,accountId:f.SettingsService.Instance.accountId,userId:n,uuid:t.d.visId}))})).catch((function(e){p.LogManager.Instance.error((0,v.buildMessage)(g.ErrorLogMessagesEnum.NETWORK_CALL_FAILED,{method:c.HttpMethodEnum.POST,err:(0,h.isObject)(e)?JSON.stringify(e):e}))}))];case 1:return o.sent(),[2]}}))}))},t.getShouldWaitForTrackingCalls=function(){return S},t.setShouldWaitForTrackingCalls=function(e){S=e},t.getMessagingEventPayload=function(e,t,n){var r=I(0,f.SettingsService.Instance.accountId+"_"+f.SettingsService.Instance.sdkKey,n,null,null);r.d.event.props[s.Constants.VWO_FS_ENVIRONMENT]=f.SettingsService.Instance.sdkKey,r.d.event.props.product="fme";var o={type:e,content:{title:t,dateTime:(0,a.getCurrentUnixTimestampInMillis)()}};return r.d.event.props.data=o,r},t.sendMessagingEvent=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a,i;return o(this,(function(o){n=new y.Deferred,r=d.NetworkManager.Instance,a=m.UrlUtil.getBaseUrl(),a=m.UrlUtil.getUpdatedBaseUrl(a);try{return i=new d.RequestModel(a,c.HttpMethodEnum.POST,l.UrlEnum.EVENTS,e,t,null,E.HTTPS,null),r.post(i).then((function(e){n.resolve(e.getData())})).catch((function(e){n.reject(e)})),[2,n.promise]}catch(e){return n.resolve(!1),[2,n.promise]}return[2]}))}))};var a=n(8470),i=n(4334),s=n(477),u=n(2209),c=n(5212),l=n(2478),g=n(2974),p=n(6178),d=n(4464),f=n(9600),h=n(7173),v=n(5076),m=n(6096),y=n(5576),E=n(3388),b=n(5291);function I(e,t,n,r,o){void 0===r&&(r=""),void 0===o&&(o="");var u=(0,i.getUUID)(t.toString(),f.SettingsService.Instance.accountId.toString()),c=f.SettingsService.Instance.sdkKey,l={vwo_sdkName:s.Constants.SDK_NAME,vwo_sdkVersion:s.Constants.SDK_VERSION,vwo_envKey:c};return{d:{msgId:"".concat(u,"-").concat((0,a.getCurrentUnixTimestampInMillis)()),visId:u,sessionId:(0,a.getCurrentUnixTimestamp)(),visitor_ua:r,visitor_ip:o,event:{props:l,name:n,time:(0,a.getCurrentUnixTimestampInMillis)()},visitor:{props:{vwo_fs_environment:c}}}}}var S=!1},1946:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=void 0;var n=function(){function e(){}return e.prototype.attachConnector=function(e){var t,n,r,o;return"class"===(null===(o=null===(r=null===(n=null===(t=null==e?void 0:e.prototype)||void 0===t?void 0:t.constructor)||void 0===n?void 0:n.toString())||void 0===r?void 0:r.trim())||void 0===o?void 0:o.substring(0,5))?this.connector=new e:this.connector=e,this.connector},Object.defineProperty(e,"Instance",{get:function(){return this.instance=this.instance||new e,this.instance},enumerable:!1,configurable:!0}),e.prototype.getConnector=function(){return this.connector},e}();t.Storage=n},2106:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.SegmentOperatorValueEnum=void 0,function(e){e.AND="and",e.NOT="not",e.OR="or",e.CUSTOM_VARIABLE="custom_variable",e.USER="user",e.COUNTRY="country",e.REGION="region",e.CITY="city",e.OPERATING_SYSTEM="os",e.DEVICE_TYPE="device_type",e.DEVICE="device",e.BROWSER_AGENT="browser_string",e.UA="ua",e.FEATURE_ID="featureId"}(n||(t.SegmentOperatorValueEnum=n={}))},2160:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VariableModel=void 0;var n=function(){function e(e,t,n,r){this.value=r,this.type=t,this.key=n,this.id=e}return e.modelFromDictionary=function(t){var n,r,o;return new e(null!==(n=t.i)&&void 0!==n?n:t.id,t.type,null!==(r=t.k)&&void 0!==r?r:t.key,null!==(o=t.val)&&void 0!==o?o:t.value)},e.prototype.setValue=function(e){this.value=e},e.prototype.setKey=function(e){this.key=e},e.prototype.setType=function(e){this.type=e},e.prototype.getId=function(){return this.id},e.prototype.getValue=function(){return this.value},e.prototype.getType=function(){return this.type},e.prototype.getKey=function(){return this.key},e}();t.VariableModel=n},2209:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.HeadersEnum=void 0,function(e){e.USER_AGENT="X-Device-User-Agent",e.IP="VWO-X-Forwarded-For"}(n||(t.HeadersEnum=n={}))},2258:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RuleModel=void 0;var n=function(){function e(){}return e.prototype.modelFromDictionary=function(e){return this.type=e.type,this.status=e.status,this.variationId=e.variationId,this.campaignId=e.campaignId,this.ruleKey=e.ruleKey,this},e.prototype.getCampaignId=function(){return this.campaignId},e.prototype.getVariationId=function(){return this.variationId},e.prototype.getStatus=function(){return this.status},e.prototype.getType=function(){return this.type},e.prototype.getRuleKey=function(){return this.ruleKey},e}();t.RuleModel=n},2404:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SegmentationManager=void 0;var a=n(7385),i=n(596),s=n(2478),u=n(6178),c=n(3166),l=n(9600),g=n(7173),p=function(){function e(){}return Object.defineProperty(e,"Instance",{get:function(){return this.instance=this.instance||new e,this.instance},enumerable:!1,configurable:!0}),e.prototype.attachEvaluator=function(e){this.evaluator=e||new a.SegmentEvaluator},e.prototype.setContextualData=function(e,t,n){return r(this,void 0,void 0,(function(){var r,a,p,d;return o(this,(function(o){switch(o.label){case 0:if(this.attachEvaluator(),this.evaluator.settings=e,this.evaluator.context=n,this.evaluator.feature=t,null===(null==n?void 0:n.getUserAgent())&&null===(null==n?void 0:n.getIpAddress()))return[2];if(!0!==t.getIsGatewayServiceRequired())return[3,4];if(!l.SettingsService.Instance.isGatewayServiceProvided||!(0,g.isUndefined)(n.getVwo())&&null!==n.getVwo())return[3,4];r={},(null==n?void 0:n.getUserAgent())&&(r.userAgent=n.getUserAgent()),(null==n?void 0:n.getIpAddress())&&(r.ipAddress=n.getIpAddress()),o.label=1;case 1:return o.trys.push([1,3,,4]),a=(0,i.getQueryParams)(r),[4,(0,i.getFromGatewayService)(a,s.UrlEnum.GET_USER_DATA)];case 2:return p=o.sent(),n.setVwo((new c.ContextVWOModel).modelFromDictionary(p)),this.evaluator.context=n,[3,4];case 3:return d=o.sent(),u.LogManager.Instance.error("Error in setting contextual data for segmentation. Got error: ".concat(d.error)),[3,4];case 4:return[2]}}))}))},e.prototype.validateSegmentation=function(e,t){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,this.evaluator.isSegmentationValid(e,t)];case 1:return[2,n.sent()]}}))}))},e}();t.SegmentationManager=p},2478:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.UrlEnum=void 0,function(e){e.EVENTS="/events/t",e.ATTRIBUTE_CHECK="/check-attribute",e.GET_USER_DATA="/get-user-details",e.BATCH_EVENTS="/server-side/batch-events-v2"}(n||(t.UrlEnum=n={}))},2550:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformEnum=void 0,function(e){e.CLIENT="client",e.SERVER="server"}(n||(t.PlatformEnum=n={}))},2676:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.VWOBuilder=void 0;var o=n(6178),a=n(4464),i=n(4988),s=n(4059),u=n(3860),c=n(9600),l=n(2974),g=n(7173),p=n(8470),d=n(5076),f=n(5576),h=n(7788),v=n(4334),m=n(5946),y=n(6977),E=n(5291),b=function(){function e(e){this.options=e}return e.prototype.setNetworkManager=function(){var e,t,n,r=a.NetworkManager.Instance;return r.attachClient(null===(t=null===(e=this.options)||void 0===e?void 0:e.network)||void 0===t?void 0:t.client),o.LogManager.Instance.debug((0,d.buildMessage)(l.DebugLogMessagesEnum.SERVICE_INITIALIZED,{service:"Network Layer"})),r.getConfig().setDevelopmentMode(null===(n=this.options)||void 0===n?void 0:n.isDevelopmentMode),this},e.prototype.initBatching=function(){var e=this;if(this.options.batchEventData){if(this.settingFileManager.isGatewayServiceProvided)return o.LogManager.Instance.info((0,d.buildMessage)(l.InfoLogMessagesEnum.GATEWAY_AND_BATCH_EVENTS_CONFIG_MISMATCH)),this;if((!(0,g.isNumber)(this.options.batchEventData.eventsPerRequest)||this.options.batchEventData.eventsPerRequest<=0)&&(!(0,g.isNumber)(this.options.batchEventData.requestTimeInterval)||this.options.batchEventData.requestTimeInterval<=0))return o.LogManager.Instance.error("Invalid batch events config, should be an object, eventsPerRequest should be a number greater than 0 and requestTimeInterval should be a number greater than 0"),this;this.batchEventsQueue=new m.BatchEventsQueue(Object.assign({},this.options.batchEventData,{dispatcher:function(t,n){return y.BatchEventsDispatcher.dispatch({ev:t},n,Object.assign({},{a:e.options.accountId,env:e.options.sdkKey}))}})),this.batchEventsQueue.flushAndClearTimer.bind(this.batchEventsQueue)}return this},e.prototype.setSegmentation=function(){var e;return i.SegmentationManager.Instance.attachEvaluator(null===(e=this.options)||void 0===e?void 0:e.segmentation),o.LogManager.Instance.debug((0,d.buildMessage)(l.DebugLogMessagesEnum.SERVICE_INITIALIZED,{service:"Segmentation Evaluator"})),this},e.prototype.fetchSettings=function(e){var t=this,n=new f.Deferred;return this.isSettingsFetchInProgress?this.fetchSettings(e):(this.isSettingsFetchInProgress=!0,this.settingFileManager.getSettings(e).then((function(r){e||(t.originalSettings=r),t.isSettingsFetchInProgress=!1,n.resolve(r)})),n.promise)},e.prototype.getSettings=function(e){var t=new f.Deferred;try{!e&&this.settings?(o.LogManager.Instance.info("Using already fetched and cached settings"),t.resolve(this.settings)):this.fetchSettings(e).then((function(e){t.resolve(e)}))}catch(e){o.LogManager.Instance.error("Failed to fetch settings. Error: "+e),t.resolve({})}return t.promise},e.prototype.setStorage=function(){var e,t,a,i;if(this.options.storage)this.storage=s.Storage.Instance.attachConnector(this.options.storage);else if(void 0===process.env&&"undefined"!=typeof window&&window.localStorage){var u=n(1007).BrowserStorageConnector;this.storage=s.Storage.Instance.attachConnector(new u(r(r({},this.options.clientStorage),{alwaysUseCachedSettings:null===(e=this.options.clientStorage)||void 0===e?void 0:e.alwaysUseCachedSettings,ttl:null===(t=this.options.clientStorage)||void 0===t?void 0:t.ttl}))),o.LogManager.Instance.debug((0,d.buildMessage)(l.DebugLogMessagesEnum.SERVICE_INITIALIZED,{service:(null===(i=null===(a=this.options)||void 0===a?void 0:a.clientStorage)||void 0===i?void 0:i.provider)===sessionStorage?"Session Storage":"Local Storage"}))}else this.storage=null;return this},e.prototype.setSettingsService=function(){return this.settingFileManager=new c.SettingsService(this.options),this},e.prototype.setLogger=function(){return this.logManager=new o.LogManager(this.options.logger||{}),o.LogManager.Instance.debug((0,d.buildMessage)(l.DebugLogMessagesEnum.SERVICE_INITIALIZED,{service:"Logger"})),this},e.prototype.getRandomUserId=function(){var e="getRandomUserId";try{return o.LogManager.Instance.debug((0,d.buildMessage)(l.DebugLogMessagesEnum.API_CALLED,{apiName:e})),(0,v.getRandomUUID)(this.options.sdkKey)}catch(t){o.LogManager.Instance.error((0,d.buildMessage)(l.ErrorLogMessagesEnum.API_THROW_ERROR,{apiName:e,err:t}))}},e.prototype.initPolling=function(){return this.options.pollInterval?this.options.pollInterval&&!(0,g.isNumber)(this.options.pollInterval)||this.options.pollInterval&&this.options.pollInterval<1e3?(o.LogManager.Instance.error((0,d.buildMessage)(l.ErrorLogMessagesEnum.INIT_OPTIONS_INVALID,{key:"pollInterval",correctType:"number"})),this):(this.checkAndPoll(),this):this},e.prototype.initUsageStats=function(){return this.options.isUsageStatsDisabled||E.UsageStatsUtil.getInstance().setUsageStats(this.options),this},e.prototype.build=function(e){return this.vwoInstance=new u.VWOClient(e,this.options),this.vwoInstance},e.prototype.checkAndPoll=function(){var e=this,t=this.options.pollInterval;setInterval((function(){e.getSettings(!0).then((function(t){var n=JSON.stringify(e.originalSettings);if(JSON.stringify(t)!==n){e.originalSettings=t;var r=(0,p.cloneObject)(t);o.LogManager.Instance.info(l.InfoLogMessagesEnum.POLLING_SET_SETTINGS),(0,h.setSettingsAndAddCampaignsToRules)(r,e.vwoInstance)}else o.LogManager.Instance.info(l.InfoLogMessagesEnum.POLLING_NO_CHANGE_IN_SETTINGS)})).catch((function(){o.LogManager.Instance.error(l.ErrorLogMessagesEnum.POLLING_FETCH_SETTINGS_FAILED)}))}),t)},e}();t.VWOBuilder=b},2974:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorLogMessagesEnum=t.InfoLogMessagesEnum=t.DebugLogMessagesEnum=void 0;var r=n(6826),o=r.debugMessages;t.DebugLogMessagesEnum=o;var a=r.infoMessages;t.InfoLogMessagesEnum=a;var i=r.errorMessages;t.ErrorLogMessagesEnum=i},3090:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.FlagApi=t.Flag=void 0;var i=n(834),s=n(6167),u=n(6947),c=n(2974),l=n(8198),g=n(2160),p=n(1463),d=n(6178),f=n(4988),h=n(1566),v=n(5479),m=n(7173),y=n(9455),E=n(8470),b=n(9284),I=n(5076),S=n(5576),T=n(689),_=n(1943),O=function(){function e(e,t){this.enabled=e,this.variation=t}return e.prototype.isEnabled=function(){return this.enabled},e.prototype.getVariables=function(){var e;return(null===(e=this.variation)||void 0===e?void 0:e.getVariables())||[]},e.prototype.getVariable=function(e,t){var n,r,o=null===(r=null===(n=this.variation)||void 0===n?void 0:n.getVariables().find((function(t){return g.VariableModel.modelFromDictionary(t).getKey()===e})))||void 0===r?void 0:r.getValue();return void 0!==o?o:t},e}();t.Flag=O;var M=function(){function e(){}return e.get=function(e,t,n,g){return o(this,void 0,void 0,(function(){var o,M,L,A,R,C,N,V,P,D,k,U,j,x,G,F,K,H,B,W,q,Q,Y,X,J,Z,z,$,ee,te,ne,re,oe,ae;return a(this,(function(a){switch(a.label){case 0:return o=!1,M=null,L=null,A=!1,R={},C=new S.Deferred,N=new Map,V=(0,E.getFeatureFromKey)(t,e),P={featureName:null==V?void 0:V.getName(),featureId:null==V?void 0:V.getId(),featureKey:null==V?void 0:V.getKey(),userId:null==n?void 0:n.getId(),api:s.ApiEnum.GET_FLAG},D=new h.StorageService,[4,(new i.StorageDecorator).getFeatureFromStorage(e,n,D)];case 1:if(null==(k=a.sent())?void 0:k.experimentVariationId){if(k.experimentKey&&(te=(0,v.getVariationFromCampaignKey)(t,k.experimentKey,k.experimentVariationId)))return d.LogManager.Instance.info((0,I.buildMessage)(c.InfoLogMessagesEnum.STORED_VARIATION_FOUND,{variationKey:te.getKey(),userId:n.getId(),experimentType:"experiment",experimentKey:k.experimentKey})),C.resolve(new O(!0,te)),[2,C.promise]}else(null==k?void 0:k.rolloutKey)&&(null==k?void 0:k.rolloutId)&&(te=(0,v.getVariationFromCampaignKey)(t,k.rolloutKey,k.rolloutVariationId))&&(d.LogManager.Instance.info((0,I.buildMessage)(c.InfoLogMessagesEnum.STORED_VARIATION_FOUND,{variationKey:te.getKey(),userId:n.getId(),experimentType:"rollout",experimentKey:k.rolloutKey})),d.LogManager.Instance.debug((0,I.buildMessage)(c.DebugLogMessagesEnum.EXPERIMENTS_EVALUATION_WHEN_ROLLOUT_PASSED,{userId:n.getId()})),o=!0,A=!0,M=te,U={rolloutId:k.rolloutId,rolloutKey:k.rolloutKey,rolloutVariationId:k.rolloutVariationId},N.set(e,U),Object.assign(R,U));return(0,m.isObject)(V)&&void 0!==V?[4,f.SegmentationManager.Instance.setContextualData(t,V,n)]:(d.LogManager.Instance.error((0,I.buildMessage)(c.ErrorLogMessagesEnum.FEATURE_NOT_FOUND,{featureKey:e})),C.reject({}),[2,C.promise]);case 2:if(a.sent(),!((j=(0,E.getSpecificRulesBasedOnType)(V,u.CampaignTypeEnum.ROLLOUT)).length>0)||o)return[3,10];x=[],G=0,F=j,a.label=3;case 3:return G<F.length?(X=F[G],[4,(0,T.evaluateRule)(t,V,X,n,N,null,D,P)]):[3,6];case 4:return K=a.sent(),Z=K.preSegmentationResult,$=K.updatedDecision,Object.assign(P,$),Z?(x.push(X),N.set(e,{rolloutId:X.getId(),rolloutKey:X.getKey(),rolloutVariationId:null===(ne=X.getVariations()[0])||void 0===ne?void 0:ne.getId()}),[3,6]):[3,5];case 5:return G++,[3,3];case 6:return x.length>0?(H=(new l.CampaignModel).modelFromDictionary(x[0]),te=(0,y.evaluateTrafficAndGetVariation)(t,H,n.getId()),(0,m.isObject)(te)&&Object.keys(te).length>0?(o=!0,A=!0,M=te,w(H,te,R,P),(0,_.getShouldWaitForTrackingCalls)()?[4,(0,b.createAndSendImpressionForVariationShown)(t,H.getId(),te.getId(),n)]:[3,8]):[3,9]):[3,9];case 7:return a.sent(),[3,9];case 8:(0,b.createAndSendImpressionForVariationShown)(t,H.getId(),te.getId(),n),a.label=9;case 9:return[3,11];case 10:0===j.length&&(d.LogManager.Instance.debug(c.DebugLogMessagesEnum.EXPERIMENTS_EVALUATION_WHEN_NO_ROLLOUT_PRESENT),A=!0),a.label=11;case 11:if(!A)return[3,18];B=[],W=(0,E.getAllExperimentRules)(V),q=new Map,Q=0,Y=W,a.label=12;case 12:return Q<Y.length?(X=Y[Q],[4,(0,T.evaluateRule)(t,V,X,n,N,q,D,P)]):[3,15];case 13:return J=a.sent(),Z=J.preSegmentationResult,z=J.whitelistedObject,$=J.updatedDecision,Object.assign(P,$),Z?(null===z?B.push(X):(o=!0,L=z.variation,Object.assign(R,{experimentId:X.getId(),experimentKey:X.getKey(),experimentVariationId:z.variationId})),[3,15]):[3,14];case 14:return Q++,[3,12];case 15:return B.length>0?(ee=(new l.CampaignModel).modelFromDictionary(B[0]),te=(0,y.evaluateTrafficAndGetVariation)(t,ee,n.getId()),(0,m.isObject)(te)&&Object.keys(te).length>0?(o=!0,L=te,w(ee,te,R,P),(0,_.getShouldWaitForTrackingCalls)()?[4,(0,b.createAndSendImpressionForVariationShown)(t,ee.getId(),te.getId(),n)]:[3,17]):[3,18]):[3,18];case 16:return a.sent(),[3,18];case 17:(0,b.createAndSendImpressionForVariationShown)(t,ee.getId(),te.getId(),n),a.label=18;case 18:return o&&(new i.StorageDecorator).setDataInStorage(r({featureKey:e,context:n},R),D),g.set(P),g.execute(g.get()),(null===(re=V.getImpactCampaign())||void 0===re?void 0:re.getCampaignId())?(d.LogManager.Instance.info((0,I.buildMessage)(c.InfoLogMessagesEnum.IMPACT_ANALYSIS,{userId:n.getId(),featureKey:e,status:o?"enabled":"disabled"})),(0,_.getShouldWaitForTrackingCalls)()?[4,(0,b.createAndSendImpressionForVariationShown)(t,null===(oe=V.getImpactCampaign())||void 0===oe?void 0:oe.getCampaignId(),o?2:1,n)]:[3,20]):[3,21];case 19:return a.sent(),[3,21];case 20:(0,b.createAndSendImpressionForVariationShown)(t,null===(ae=V.getImpactCampaign())||void 0===ae?void 0:ae.getCampaignId(),o?2:1,n),a.label=21;case 21:return C.resolve(new O(o,(new p.VariationModel).modelFromDictionary(null!=L?L:M))),[2,C.promise]}}))}))},e}();function w(e,t,n,r){e.getType()===u.CampaignTypeEnum.ROLLOUT?Object.assign(n,{rolloutId:e.getId(),rolloutKey:e.getKey(),rolloutVariationId:t.getId()}):Object.assign(n,{experimentId:e.getId(),experimentKey:e.getKey(),experimentVariationId:t.getId()}),Object.assign(r,n)}t.FlagApi=M},3166:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContextVWOModel=void 0;var n=function(){function e(){}return e.prototype.modelFromDictionary=function(e){return(null==e?void 0:e.location)&&(this.location=e.location),(null==e?void 0:e.userAgent)&&(this.userAgent=e.userAgent),this},e.prototype.getLocation=function(){return this.location},e.prototype.getUaInfo=function(){return this.userAgent},e}();t.ContextVWOModel=n},3289:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=n(7173),o=function(){function e(e){var t;this.callback=null===(t=e.integrations)||void 0===t?void 0:t.callback,this.isCallBackFunction=(0,r.isFunction)(this.callback),this.decision={}}return e.prototype.execute=function(e){this.isCallBackFunction&&this.callback(e)},e.prototype.set=function(e){this.isCallBackFunction&&(this.decision=e)},e.prototype.get=function(){return this.decision},e}();t.default=o},3388:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HTTPS_PROTOCOL=t.HTTP_PROTOCOL=t.SEED_URL=t.HTTPS=t.HTTP=void 0,t.HTTP="http",t.HTTPS="https",t.SEED_URL="https://vwo.com",t.HTTP_PROTOCOL="".concat(t.HTTP,"://"),t.HTTPS_PROTOCOL="".concat(t.HTTPS,"://")},3585:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.SegmentOperandRegexEnum=void 0,function(e){e.LOWER="^lower",e.LOWER_MATCH="^lower\\((.*)\\)",e.WILDCARD="^wildcard",e.WILDCARD_MATCH="^wildcard\\((.*)\\)",e.REGEX="^regex",e.REGEX_MATCH="^regex\\((.*)\\)",e.STARTING_STAR="^\\*",e.ENDING_STAR="\\*$",e.GREATER_THAN_MATCH="^gt\\((\\d+\\.?\\d*|\\.\\d+)\\)",e.GREATER_THAN_EQUAL_TO_MATCH="^gte\\((\\d+\\.?\\d*|\\.\\d+)\\)",e.LESS_THAN_MATCH="^lt\\((\\d+\\.?\\d*|\\.\\d+)\\)",e.LESS_THAN_EQUAL_TO_MATCH="^lte\\((\\d+\\.?\\d*|\\.\\d+)\\)"}(n||(t.SegmentOperandRegexEnum=n={}))},3647:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResponseModel=void 0;var n=function(){function e(){}return e.prototype.setStatusCode=function(e){this.statusCode=e},e.prototype.setHeaders=function(e){this.headers=e},e.prototype.setData=function(e){this.data=e},e.prototype.setError=function(e){this.error=e},e.prototype.getHeaders=function(){return this.headers},e.prototype.getData=function(){return this.data},e.prototype.getStatusCode=function(){return this.statusCode},e.prototype.getError=function(){return this.error},e}();t.ResponseModel=n},3725:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RequestModel=void 0;var r=n(5212),o=n(3388),a=function(){function e(e,t,n,a,i,s,u,c){void 0===t&&(t=r.HttpMethodEnum.GET),void 0===u&&(u=o.HTTPS),this.url=e,this.method=t,this.path=n,this.query=a,this.body=i,this.headers=s,this.scheme=u,this.port=c}return e.prototype.getMethod=function(){return this.method},e.prototype.setMethod=function(e){this.method=e},e.prototype.getBody=function(){return this.body},e.prototype.setBody=function(e){this.body=e},e.prototype.setQuery=function(e){this.query=e},e.prototype.getQuery=function(){return this.query},e.prototype.setHeaders=function(e){return this.headers=e,this},e.prototype.getHeaders=function(){return this.headers},e.prototype.setTimeout=function(e){return this.timeout=e,this},e.prototype.getTimeout=function(){return this.timeout},e.prototype.getUrl=function(){return this.url},e.prototype.setUrl=function(e){return this.url=e,this},e.prototype.getScheme=function(){return this.scheme},e.prototype.setScheme=function(e){return this.scheme=e,this},e.prototype.getPort=function(){return this.port},e.prototype.setPort=function(e){return this.port=e,this},e.prototype.getPath=function(){return this.path},e.prototype.setPath=function(e){return this.path=e,this},e.prototype.getOptions=function(){var e="";for(var t in this.query)e+="".concat(t,"=").concat(this.query[t],"&");var n=this.url.split("/"),r=n[0],o=n[1],a={hostname:r,agent:!1};if(this.scheme&&(a.scheme=this.scheme),this.port&&(a.port=this.port),this.headers&&(a.headers=this.headers),this.method&&(a.method=this.method),this.body){var i=JSON.stringify(this.body);a.headers=a.headers||{},a.headers["Content-Type"]="application/json","undefined"==typeof Buffer?a.headers["Content-Length"]=(new TextEncoder).encode(i).length:a.headers["Content-Length"]=Buffer.byteLength(i),a.body=this.body}return this.path&&(a.path=""!==e?this.path+"?"+e||"":this.path),o&&(a.path="/".concat(o)+a.path),this.timeout&&(a.timeout=this.timeout),"&"===a.path.charAt(a.path.length-1)&&(a.path=a.path.substring(0,a.path.length-1)),a},e}();t.RequestModel=a},3860:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.VWOClient=void 0;var a=n(6178),i=n(3090),s=n(5810),u=n(9955),c=n(2974),l=n(5946),g=n(5600),p=n(8606),d=n(3289),f=n(6096),h=n(7173),v=n(5076),m=n(5576),y=n(7788),E=n(1463),b=n(1943),I=n(9600),S=n(6167),T=function(){function e(e,t){return this.options=t,(0,y.setSettingsAndAddCampaignsToRules)(e,this),f.UrlUtil.init({collectionPrefix:this.settings.getCollectionPrefix()}),(0,b.setShouldWaitForTrackingCalls)(this.options.shouldWaitForTrackingCalls||!1),a.LogManager.Instance.info(c.InfoLogMessagesEnum.CLIENT_INITIALIZED),this.vwoClientInstance=this,this}return e.prototype.getFlag=function(e,t){var n=S.ApiEnum.GET_FLAG,r=new m.Deferred,o=new i.Flag(!1,new E.VariationModel);try{var s=new d.default(this.options);if(a.LogManager.Instance.debug((0,v.buildMessage)(c.DebugLogMessagesEnum.API_CALLED,{apiName:n})),!(0,h.isString)(e))throw a.LogManager.Instance.error((0,v.buildMessage)(c.ErrorLogMessagesEnum.API_INVALID_PARAM,{apiName:n,key:"featureKey",type:(0,h.getType)(e),correctType:"string"})),new TypeError("TypeError: featureKey should be a string");if(!(new g.SettingsSchema).isSettingsValid(this.originalSettings))throw a.LogManager.Instance.error(c.ErrorLogMessagesEnum.API_SETTING_INVALID),new Error("TypeError: Invalid Settings");if(!t||!t.id)throw a.LogManager.Instance.error(c.ErrorLogMessagesEnum.API_CONTEXT_INVALID),new TypeError("TypeError: Invalid context");var u=(new p.ContextModel).modelFromDictionary(t);i.FlagApi.get(e,this.settings,u,s).then((function(e){r.resolve(e)})).catch((function(){r.resolve(o)}))}catch(e){a.LogManager.Instance.info((0,v.buildMessage)(c.ErrorLogMessagesEnum.API_THROW_ERROR,{apiName:n,err:e})),r.resolve(o)}return r.promise},e.prototype.trackEvent=function(e,t,n){var r;void 0===n&&(n={});var o=S.ApiEnum.TRACK_EVENT,i=new m.Deferred;try{var s=new d.default(this.options);if(a.LogManager.Instance.debug((0,v.buildMessage)(c.DebugLogMessagesEnum.API_CALLED,{apiName:o})),!(0,h.isString)(e))throw a.LogManager.Instance.error((0,v.buildMessage)(c.ErrorLogMessagesEnum.API_INVALID_PARAM,{apiName:o,key:"eventName",type:(0,h.getType)(e),correctType:"string"})),new TypeError("TypeError: Event-name should be a string");if(!(0,h.isObject)(n))throw a.LogManager.Instance.error((0,v.buildMessage)(c.ErrorLogMessagesEnum.API_INVALID_PARAM,{apiName:o,key:"eventProperties",type:(0,h.getType)(n),correctType:"object"})),new TypeError("TypeError: eventProperties should be an object");if(!(new g.SettingsSchema).isSettingsValid(this.originalSettings))throw a.LogManager.Instance.error(c.ErrorLogMessagesEnum.API_SETTING_INVALID),new Error("TypeError: Invalid Settings");if(!t||!t.id)throw a.LogManager.Instance.error(c.ErrorLogMessagesEnum.API_CONTEXT_INVALID),new TypeError("TypeError: Invalid context");var l=(new p.ContextModel).modelFromDictionary(t);(new u.TrackApi).track(this.settings,e,l,n,s).then((function(e){i.resolve(e)})).catch((function(){var t;i.resolve(((t={})[e]=!1,t))}))}catch(t){a.LogManager.Instance.info((0,v.buildMessage)(c.ErrorLogMessagesEnum.API_THROW_ERROR,{apiName:o,err:t})),i.resolve(((r={})[e]=!1,r))}return i.promise},e.prototype.setAttribute=function(e,t,n){return r(this,void 0,void 0,(function(){var r,i,u,l,g,d,f,m;return o(this,(function(o){switch(o.label){case 0:r=S.ApiEnum.SET_ATTRIBUTE,o.label=1;case 1:if(o.trys.push([1,6,,7]),!(0,h.isObject)(e))return[3,3];if(a.LogManager.Instance.debug((0,v.buildMessage)(c.DebugLogMessagesEnum.API_CALLED,{apiName:r})),Object.entries(e).length<1)throw a.LogManager.Instance.error((0,v.buildMessage)("Attributes map must contain atleast 1 key-value pair",{apiName:r,key:"attributes",type:(0,h.getType)(e),correctType:"object"})),new TypeError("TypeError: Attributes should be an object containing atleast 1 key-value pair");if(i=e,!(0,h.isObject)(i))throw new TypeError("TypeError: attributes should be an object containing key-value pairs");return Object.entries(i).forEach((function(e){var t=e[0],n=e[1];if("boolean"!=typeof n&&"string"!=typeof n&&"number"!=typeof n)throw a.LogManager.Instance.error((0,v.buildMessage)(c.ErrorLogMessagesEnum.API_INVALID_PARAM,{apiName:r,key:t,type:(0,h.getType)(n),correctType:" boolean, string or number"})),new TypeError('Invalid attribute type for key "'.concat(t,'". Expected boolean, string or number, but got ').concat((0,h.getType)(n)));if(Array.isArray(n)||"object"==typeof n&&null!==n)throw a.LogManager.Instance.error((0,v.buildMessage)(c.ErrorLogMessagesEnum.API_INVALID_PARAM,{apiName:r,key:t,type:(0,h.getType)(n),correctType:" boolean | string | number | null"})),new TypeError('Invalid attribute value for key "'.concat(t,'". Arrays and objects are not supported.'))})),!n&&t&&(n=t),n&&n.id||a.LogManager.Instance.error(c.ErrorLogMessagesEnum.API_CONTEXT_INVALID),g=(new p.ContextModel).modelFromDictionary(n),[4,(new s.SetAttributeApi).setAttribute(this.settings,i,g)];case 2:return o.sent(),[3,5];case 3:if(u=e,l=t,!(0,h.isString)(u))throw new TypeError("attributeKey should be a string");if(!(0,h.isBoolean)(l)&&!(0,h.isString)(l)&&!(0,h.isNumber)(l))throw new TypeError("attributeValue should be a boolean, string, or number");if(!n||!n.id)throw new TypeError("Invalid context");return g=(new p.ContextModel).modelFromDictionary(n),(m={})[u]=l,d=m,[4,(new s.SetAttributeApi).setAttribute(this.settings,d,g)];case 4:o.sent(),o.label=5;case 5:return[3,7];case 6:return f=o.sent(),a.LogManager.Instance.info((0,v.buildMessage)(c.ErrorLogMessagesEnum.API_THROW_ERROR,{apiName:r,err:f})),[3,7];case 7:return[2]}}))}))},e.prototype.updateSettings=function(e){return r(this,arguments,void 0,(function(e,t){var n,r,i,s;return void 0===t&&(t=!0),o(this,(function(o){switch(o.label){case 0:n=S.ApiEnum.UPDATE_SETTINGS,o.label=1;case 1:return o.trys.push([1,5,,6]),a.LogManager.Instance.debug((0,v.buildMessage)(c.DebugLogMessagesEnum.API_CALLED,{apiName:n})),e&&0!==Object.keys(e).length?[3,3]:[4,I.SettingsService.Instance.fetchSettings(t)];case 2:return i=o.sent(),[3,4];case 3:i=e,o.label=4;case 4:if(r=i,!(new g.SettingsSchema).isSettingsValid(r))throw new Error("TypeError: Invalid Settings schema");return(0,y.setSettingsAndAddCampaignsToRules)(r,this.vwoClientInstance),a.LogManager.Instance.info((0,v.buildMessage)(c.InfoLogMessagesEnum.SETTINGS_UPDATED,{apiName:n,isViaWebhook:t})),[3,6];case 5:return s=o.sent(),a.LogManager.Instance.error((0,v.buildMessage)(c.ErrorLogMessagesEnum.SETTINGS_FETCH_FAILED,{apiName:n,isViaWebhook:t,err:JSON.stringify(s)})),[3,6];case 6:return[2]}}))}))},e.prototype.flushEvents=function(){var e=S.ApiEnum.FLUSH_EVENTS,t=new m.Deferred;try{if(a.LogManager.Instance.debug((0,v.buildMessage)(c.DebugLogMessagesEnum.API_CALLED,{apiName:e})),l.BatchEventsQueue.Instance)return l.BatchEventsQueue.Instance.flushAndClearTimer();a.LogManager.Instance.error("Batching is not enabled. Pass batchEventData in the SDK configuration while invoking init API."),t.resolve({status:"error",events:[]})}catch(n){a.LogManager.Instance.error((0,v.buildMessage)(c.ErrorLogMessagesEnum.API_THROW_ERROR,{apiName:e,err:n})),t.resolve({status:"error",events:[]})}return t.promise},e}();t.VWOClient=T},3903:e=>{e.exports=require("uuid")},3904:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SegmentOperandEvaluator=void 0;var a=n(7131),i=n(9227),s=n(3585),u=n(7173),c=n(596),l=n(2478),g=n(6178),p=function(){function e(){}return e.prototype.evaluateCustomVariableDSL=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i,s,u,p,d,f,h,v,m,y,E,b,I,S,T;return o(this,(function(o){switch(o.label){case 0:if(n=(0,a.getKeyValue)(e),r=n.key,i=n.value,s=r,u=i,!Object.prototype.hasOwnProperty.call(t,s))return[2,!1];if(!u.includes("inlist"))return[3,5];if(p=/inlist\(([^)]+)\)/,!(d=u.match(p))||d.length<2)return g.LogManager.Instance.error("Invalid 'inList' operand format"),[2,!1];E=t[s],f=this.preProcessTagValue(E),h=d[1],v={attribute:f,listId:h},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,(0,c.getFromGatewayService)(v,l.UrlEnum.ATTRIBUTE_CHECK)];case 2:return(m=o.sent())&&void 0!==m&&"false"!==m&&0!==m.status?[2,m]:[2,!1];case 3:return y=o.sent(),g.LogManager.Instance.error("Error while fetching data: "+y),[2,!1];case 4:return[3,6];case 5:return E=t[s],E=this.preProcessTagValue(E),b=this.preProcessOperandValue(u),I=b.operandType,S=b.operandValue,T=this.processValues(S,E),E=T.tagValue,[2,this.extractResult(I,T.operandValue,E)];case 6:return[2]}}))}))},e.prototype.evaluateUserDSL=function(e,t){for(var n=e.split(","),r=0;r<n.length;r++)if(n[r].trim()==t._vwoUserId)return!0;return!1},e.prototype.evaluateUserAgentDSL=function(e,t){var n=e;if(!t.getUserAgent()||void 0===t.getUserAgent())return g.LogManager.Instance.info("To Evaluate UserAgent segmentation, please provide userAgent in context"),!1;var r=decodeURIComponent(t.getUserAgent()),o=this.preProcessOperandValue(n),a=o.operandType,i=o.operandValue,s=this.processValues(i,r);return r=s.tagValue,this.extractResult(a,s.operandValue,r)},e.prototype.preProcessTagValue=function(e){return void 0===e&&(e=""),(0,u.isBoolean)(e)&&(e=!!e),null!==e&&(e=e.toString()),e},e.prototype.preProcessOperandValue=function(e){var t,n;if((0,a.matchWithRegex)(e,s.SegmentOperandRegexEnum.LOWER_MATCH))t=i.SegmentOperandValueEnum.LOWER_VALUE,n=this.extractOperandValue(e,s.SegmentOperandRegexEnum.LOWER_MATCH);else if((0,a.matchWithRegex)(e,s.SegmentOperandRegexEnum.WILDCARD_MATCH)){n=this.extractOperandValue(e,s.SegmentOperandRegexEnum.WILDCARD_MATCH);var r=(0,a.matchWithRegex)(n,s.SegmentOperandRegexEnum.STARTING_STAR),o=(0,a.matchWithRegex)(n,s.SegmentOperandRegexEnum.ENDING_STAR);r&&o?t=i.SegmentOperandValueEnum.STARTING_ENDING_STAR_VALUE:r?t=i.SegmentOperandValueEnum.STARTING_STAR_VALUE:o&&(t=i.SegmentOperandValueEnum.ENDING_STAR_VALUE),n=n.replace(new RegExp(s.SegmentOperandRegexEnum.STARTING_STAR),"").replace(new RegExp(s.SegmentOperandRegexEnum.ENDING_STAR),"")}else(0,a.matchWithRegex)(e,s.SegmentOperandRegexEnum.REGEX_MATCH)?(t=i.SegmentOperandValueEnum.REGEX_VALUE,n=this.extractOperandValue(e,s.SegmentOperandRegexEnum.REGEX_MATCH)):(0,a.matchWithRegex)(e,s.SegmentOperandRegexEnum.GREATER_THAN_MATCH)?(t=i.SegmentOperandValueEnum.GREATER_THAN_VALUE,n=this.extractOperandValue(e,s.SegmentOperandRegexEnum.GREATER_THAN_MATCH)):(0,a.matchWithRegex)(e,s.SegmentOperandRegexEnum.GREATER_THAN_EQUAL_TO_MATCH)?(t=i.SegmentOperandValueEnum.GREATER_THAN_EQUAL_TO_VALUE,n=this.extractOperandValue(e,s.SegmentOperandRegexEnum.GREATER_THAN_EQUAL_TO_MATCH)):(0,a.matchWithRegex)(e,s.SegmentOperandRegexEnum.LESS_THAN_MATCH)?(t=i.SegmentOperandValueEnum.LESS_THAN_VALUE,n=this.extractOperandValue(e,s.SegmentOperandRegexEnum.LESS_THAN_MATCH)):(0,a.matchWithRegex)(e,s.SegmentOperandRegexEnum.LESS_THAN_EQUAL_TO_MATCH)?(t=i.SegmentOperandValueEnum.LESS_THAN_EQUAL_TO_VALUE,n=this.extractOperandValue(e,s.SegmentOperandRegexEnum.LESS_THAN_EQUAL_TO_MATCH)):(t=i.SegmentOperandValueEnum.EQUAL_VALUE,n=e);return{operandType:t,operandValue:n}},e.prototype.extractOperandValue=function(e,t){return(0,a.matchWithRegex)(e,t)&&(0,a.matchWithRegex)(e,t)[1]},e.prototype.processValues=function(e,t){var n=parseFloat(e),r=parseFloat(t);return n&&r?{operandValue:n.toString(),tagValue:r.toString()}:{operandValue:e,tagValue:t}},e.prototype.extractResult=function(e,t,n){var r;switch(e){case i.SegmentOperandValueEnum.LOWER_VALUE:null!==n&&(r=t.toLowerCase()===n.toLowerCase());break;case i.SegmentOperandValueEnum.STARTING_ENDING_STAR_VALUE:null!==n&&(r=n.indexOf(t)>-1);break;case i.SegmentOperandValueEnum.STARTING_STAR_VALUE:null!==n&&(r=n.endsWith(t));break;case i.SegmentOperandValueEnum.ENDING_STAR_VALUE:null!==n&&(r=n.startsWith(t));break;case i.SegmentOperandValueEnum.REGEX_VALUE:try{r=!!new RegExp(t,"g").test(n)}catch(e){r=!1}break;case i.SegmentOperandValueEnum.GREATER_THAN_VALUE:if(null!==n)try{r=parseFloat(t)<parseFloat(n)}catch(e){r=!1}break;case i.SegmentOperandValueEnum.GREATER_THAN_EQUAL_TO_VALUE:if(null!==n)try{r=parseFloat(t)<=parseFloat(n)}catch(e){r=!1}break;case i.SegmentOperandValueEnum.LESS_THAN_VALUE:if(null!==n)try{r=parseFloat(t)>parseFloat(n)}catch(e){r=!1}break;case i.SegmentOperandValueEnum.LESS_THAN_EQUAL_TO_VALUE:if(null!==n)try{r=parseFloat(t)>=parseFloat(n)}catch(e){r=!1}break;default:r=n===t}return r},e}();t.SegmentOperandEvaluator=p},3991:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.CampaignDecisionService=void 0;var a=n(6365),i=n(6178),s=n(4988),u=n(477),c=n(6947),l=n(2974),g=n(7173),p=n(5076),d=function(){function e(){}return e.prototype.isUserPartOfCampaign=function(e,t){if(!t||!e)return!1;var n=t.getType()===c.CampaignTypeEnum.ROLLOUT||t.getType()===c.CampaignTypeEnum.PERSONALIZE,r=n?t.getVariations()[0].getSalt():t.getSalt(),o=n?t.getVariations()[0].getWeight():t.getTraffic(),s=r?"".concat(r,"_").concat(e):"".concat(t.getId(),"_").concat(e),u=(new a.DecisionMaker).getBucketValueForUser(s),g=0!==u&&u<=o;return i.LogManager.Instance.info((0,p.buildMessage)(l.InfoLogMessagesEnum.USER_PART_OF_CAMPAIGN,{userId:e,notPart:g?"":"not",campaignKey:t.getType()===c.CampaignTypeEnum.AB?t.getKey():t.getName()+"_"+t.getRuleKey()})),g},e.prototype.getVariation=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(t>=r.getStartRangeVariation()&&t<=r.getEndRangeVariation())return r}return null},e.prototype.checkInRange=function(e,t){if(t>=e.getStartRangeVariation()&&t<=e.getEndRangeVariation())return e},e.prototype.bucketUserToVariation=function(e,t,n){var r;if(!n||!e)return null;n.getTraffic()&&(r=1);var o=n.getTraffic(),s=n.getSalt(),c=s?"".concat(s,"_").concat(t,"_").concat(e):"".concat(n.getId(),"_").concat(t,"_").concat(e),g=(new a.DecisionMaker).generateHashValue(c),d=(new a.DecisionMaker).generateBucketValue(g,u.Constants.MAX_TRAFFIC_VALUE,r);return i.LogManager.Instance.debug((0,p.buildMessage)(l.DebugLogMessagesEnum.USER_BUCKET_TO_VARIATION,{userId:e,campaignKey:n.getKey(),percentTraffic:o,bucketValue:d,hashValue:g})),this.getVariation(n.getVariations(),d)},e.prototype.getPreSegmentationDecision=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:return n=e.getType(),r={},n===c.CampaignTypeEnum.ROLLOUT||n===c.CampaignTypeEnum.PERSONALIZE?r=e.getVariations()[0].getSegments():n===c.CampaignTypeEnum.AB&&(r=e.getSegments()),!(0,g.isObject)(r)||Object.keys(r).length?[3,1]:(i.LogManager.Instance.info((0,p.buildMessage)(l.InfoLogMessagesEnum.SEGMENTATION_SKIP,{userId:t.getId(),campaignKey:e.getType()===c.CampaignTypeEnum.AB?e.getKey():e.getName()+"_"+e.getRuleKey()})),[2,!0]);case 1:return[4,s.SegmentationManager.Instance.validateSegmentation(r,t.getCustomVariables())];case 2:return o.sent()?(i.LogManager.Instance.info((0,p.buildMessage)(l.InfoLogMessagesEnum.SEGMENTATION_STATUS,{userId:t.getId(),campaignKey:e.getType()===c.CampaignTypeEnum.AB?e.getKey():e.getName()+"_"+e.getRuleKey(),status:"passed"})),[2,!0]):(i.LogManager.Instance.info((0,p.buildMessage)(l.InfoLogMessagesEnum.SEGMENTATION_STATUS,{userId:t.getId(),campaignKey:e.getType()===c.CampaignTypeEnum.AB?e.getKey():e.getName()+"_"+e.getRuleKey(),status:"failed"})),[2,!1])}}))}))},e.prototype.getVariationAlloted=function(e,t,n){var r=this.isUserPartOfCampaign(e,n);return n.getType()===c.CampaignTypeEnum.ROLLOUT||n.getType()===c.CampaignTypeEnum.PERSONALIZE?r?n.getVariations()[0]:null:r?this.bucketUserToVariation(e,t,n):null},e}();t.CampaignDecisionService=d},4059:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=void 0;var r=n(1946);Object.defineProperty(t,"Storage",{enumerable:!0,get:function(){return r.Storage}})},4334:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRandomUUID=function(e){var t=(0,a.v5)(e,a.v5.DNS);return(0,a.v5)((0,o.v4)(),t)},t.getUUID=function(e,t){var n=(0,a.v5)(r.SEED_URL,a.v5.URL);e=String(e);var o=i(t=String(t),n),s=i(e,o);return null==s?void 0:s.replace(/-/gi,"").toUpperCase()},t.generateUUID=i;var r=n(3388),o=n(3903),a=n(3903);function i(e,t){if(e&&t)return(0,a.v5)(e,t)}},4464:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResponseModel=t.RequestModel=t.GlobalRequestModel=t.NetworkManager=t.NetworkClient=void 0,void 0===process.env?t.NetworkClient=n(7005).o:t.NetworkClient=n(6787)._;var r=n(119);Object.defineProperty(t,"NetworkManager",{enumerable:!0,get:function(){return r.NetworkManager}});var o=n(7666);Object.defineProperty(t,"GlobalRequestModel",{enumerable:!0,get:function(){return o.GlobalRequestModel}});var a=n(3725);Object.defineProperty(t,"RequestModel",{enumerable:!0,get:function(){return a.RequestModel}});var i=n(3647);Object.defineProperty(t,"ResponseModel",{enumerable:!0,get:function(){return i.ResponseModel}})},4868:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sendGetCall=function(e){c(r.HttpMethodEnum.GET,e)},t.sendPostCall=function(e){c(r.HttpMethodEnum.POST,e)};var r=n(5212),o=n(6178),a=n(5076),i=n(2974),s=n(477),u=function(){};function c(e,t){var n=t.networkOptions,c=t.successCallback,l=void 0===c?u:c,g=t.errorCallback,p=void 0===g?u:g,d=0;!function t(){var u="".concat(n.scheme,"://").concat(n.hostname).concat(n.path);n.port&&(u="".concat(n.scheme,"://").concat(n.hostname,":").concat(n.port).concat(n.path));var c=n.body,g=n.headers||{},f=n.timeout,h=new XMLHttpRequest;function v(e){if(d<s.Constants.MAX_RETRIES){d++;var n=s.Constants.RETRY_DELAY*Math.pow(2,d);o.LogManager.Instance.error((0,a.buildMessage)(i.ErrorLogMessagesEnum.NETWORK_CALL_RETRY_ATTEMPT,{endPoint:u.split("?")[0],err:e,delay:n/1e3,attempt:d,maxRetries:s.Constants.MAX_RETRIES})),setTimeout(t,n)}else o.LogManager.Instance.error((0,a.buildMessage)(i.ErrorLogMessagesEnum.NETWORK_CALL_RETRY_FAILED,{endPoint:u.split("?")[0],err:e})),p(e)}for(var m in f&&(h.timeout=f),h.onload=function(){if(h.status>=200&&h.status<300){var t=h.responseText;if(e===r.HttpMethodEnum.GET){var n=JSON.parse(t);l(n)}else l(t)}else 400===h.status?p(h.statusText):v(h.statusText)},h.onerror=function(){v("".concat(h.statusText,", status: ").concat(h.status))},f&&(h.ontimeout=function(){v("Request timed out")}),h.open(e,u,!0),g)m in g&&"Content-Type"!==m&&"Content-Length"!==m&&h.setRequestHeader(m,g[m]);e===r.HttpMethodEnum.POST&&"string"!=typeof c?h.send(JSON.stringify(c)):e===r.HttpMethodEnum.GET&&h.send()}()}},4988:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SegmentEvaluator=t.SegmentationManager=void 0;var r=n(2404);Object.defineProperty(t,"SegmentationManager",{enumerable:!0,get:function(){return r.SegmentationManager}});var o=n(7385);Object.defineProperty(t,"SegmentEvaluator",{enumerable:!0,get:function(){return o.SegmentEvaluator}})},5076:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildMessage=p,t.sendLogToVWO=function(e,t){if(void 0===process.env||"true"!==process.env.TEST_ENV){var n=e;if(e.includes("Retrying in")&&(n=e.split("Retrying")[0].trim()),n=n+"-"+r.Constants.SDK_NAME+"-"+r.Constants.SDK_VERSION,!g.has(n)){g.add(n);var a=(0,i.getEventsBaseProperties)(o.EventEnum.VWO_LOG_EVENT),l=(0,i.getMessagingEventPayload)(t,e,o.EventEnum.VWO_LOG_EVENT);(0,i.sendMessagingEvent)(a,l).catch((function(e){s.LogManager.Instance.error(p(u.ErrorLogMessagesEnum.NETWORK_CALL_FAILED,{method:c.HttpMethodEnum.POST+" "+o.EventEnum.VWO_LOG_EVENT,err:e.getError()}),!1)}))}}};var r=n(477),o=n(7111),a=n(7173),i=n(1943),s=n(7623),u=n(2974),c=n(5212),l=/\{([0-9a-zA-Z_]+)\}/g,g=new Set;function p(e,t){void 0===t&&(t={});try{return e.replace(l,(function(n,r,o){if("{"===e[o-1]&&"}"===e[o+n.length])return r;var i=t[r];return null==i?"":(0,a.isFunction)(i)?i():i}))}catch(t){return e}}},5212:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.HttpMethodEnum=void 0,function(e){e.GET="GET",e.POST="POST"}(n||(t.HttpMethodEnum=n={}))},5224:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;t.Logger=function(){}},5291:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UsageStatsUtil=void 0;var r=n(1202),o=function(){function e(){this.usageStatsData={}}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.setUsageStats=function(e){var t,n=e.storage,o=e.logger,a=e.batchEvents,i=e.gatewayService,s=e.integrations,u=e.pollingInterval,c=e._vwo_meta,l=e.shouldWaitForTrackingCalls,g={};s&&(g.ig=1),a&&(g.eb=1),o&&(o.transport||o.transports)&&(g.cl=1),n&&(g.ss=1),(null==o?void 0:o.level)&&(g.ll=null!==(t=r.LogLevelNumberEnum[o.level.toUpperCase()])&&void 0!==t?t:-1),i&&(g.gs=1),u&&(g.pi=1),l&&(g.swtc=1),c&&c.ea&&(g._ea=1),void 0===process.env&&"undefined"!=typeof XMLHttpRequest||("undefined"!=typeof process&&process.version&&(g.lv=process.version),this.usageStatsData=g)},e.prototype.getUsageStats=function(){return this.usageStatsData},e.prototype.clearUsageStats=function(){this.usageStatsData={}},e}();t.UsageStatsUtil=o},5479:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setVariationAllocation=function(e){if(e.getType()===o.CampaignTypeEnum.ROLLOUT||e.getType()===o.CampaignTypeEnum.PERSONALIZE)!function(e){for(var t=0;t<e.getVariations().length;t++){var n=e.getVariations()[t],r=100*e.getVariations()[t].getWeight();n.setStartRange(1),n.setEndRange(r),s.LogManager.Instance.info((0,u.buildMessage)(a.InfoLogMessagesEnum.VARIATION_RANGE_ALLOCATION,{variationKey:n.getKey(),campaignKey:e.getKey(),variationWeight:n.getWeight(),startRange:1,endRange:r}))}}(e);else{var t=0;e.getVariations().forEach((function(n){var r=c(n,t);t+=r,s.LogManager.Instance.info((0,u.buildMessage)(a.InfoLogMessagesEnum.VARIATION_RANGE_ALLOCATION,{variationKey:n.getKey(),campaignKey:e.getKey(),variationWeight:n.getWeight(),startRange:n.getStartRangeVariation(),endRange:n.getEndRangeVariation()}))}))}},t.assignRangeValues=c,t.scaleVariationWeights=function(e){var t=e.reduce((function(e,t){return e+t.weight}),0);if(t)e.forEach((function(e){return e.weight=e.weight/t*100}));else{var n=100/e.length;e.forEach((function(e){return e.weight=n}))}},t.getBucketingSeed=function(e,t,n){if(n)return"".concat(n,"_").concat(e);var r=t.getType()===o.CampaignTypeEnum.ROLLOUT||t.getType()===o.CampaignTypeEnum.PERSONALIZE?t.getVariations()[0].getSalt():t.getSalt();return r?"".concat(r,"_").concat(e):"".concat(t.getId(),"_").concat(e)},t.getVariationFromCampaignKey=function(e,t,n){var r=e.getCampaigns().find((function(e){return e.getKey()===t}));if(r){var o=r.getVariations().find((function(e){return e.getId()===n}));if(o)return(new i.VariationModel).modelFromDictionary(o)}return null},t.setCampaignAllocation=function(e){for(var t=0,n=0;t<e.length;t++)n+=l(e[t],n)},t.getGroupDetailsIfCampaignPartOfIt=function(e,t,n){void 0===n&&(n=null);var r=t.toString();return null!==n&&(r="".concat(t,"_").concat(n).toString()),e.getCampaignGroups()&&Object.prototype.hasOwnProperty.call(e.getCampaignGroups(),r)?{groupId:e.getCampaignGroups()[r],groupName:e.getGroups()[e.getCampaignGroups()[r]].name}:{}},t.getCampaignsByGroupId=function(e,t){var n=e.getGroups()[t];return n?n.campaigns:[]},t.getFeatureKeysFromCampaignIds=function(e,t){for(var n=[],r=function(t){var r=t.split("_").map(Number),o=r[0],a=r[1];e.getFeatures().forEach((function(e){-1===n.indexOf(e.getKey())&&e.getRules().forEach((function(t){t.getCampaignId()===o&&(null!=a?t.getVariationId()===a&&n.push(e.getKey()):n.push(e.getKey()))}))}))},o=0,a=t;o<a.length;o++)r(a[o]);return n},t.getCampaignIdsFromFeatureKey=function(e,t){var n=[];return e.getFeatures().forEach((function(e){e.getKey()===t&&e.getRules().forEach((function(e){n.push(e.getCampaignId())}))})),n},t.assignRangeValuesMEG=l;var r=n(477),o=n(6947),a=n(2974),i=n(1463),s=n(6178),u=n(5076);function c(e,t){var n=g(e.getWeight());return n?(e.setStartRange(t+1),e.setEndRange(t+n)):(e.setStartRange(-1),e.setEndRange(-1)),n}function l(e,t){var n=g(e.weight);return n?(e.startRangeVariation=t+1,e.endRangeVariation=t+n):(e.startRangeVariation=-1,e.endRangeVariation=-1),n}function g(e){if(!e||0===e)return 0;var t=Math.ceil(100*e);return Math.min(t,r.Constants.MAX_TRAFFIC_VALUE)}},5576:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Deferred=function(){var e=this;return this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n})),this}},5600:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsSchema=void 0;var r=n(6190),o=function(){function e(){this.initializeSchemas()}return e.prototype.initializeSchemas=function(){this.campaignMetricSchema=(0,r.object)({id:(0,r.union)([(0,r.number)(),(0,r.string)()]),type:(0,r.string)(),identifier:(0,r.string)(),mca:(0,r.optional)((0,r.union)([(0,r.number)(),(0,r.string)()])),hasProps:(0,r.optional)((0,r.boolean)()),revenueProp:(0,r.optional)((0,r.string)())}),this.variableObjectSchema=(0,r.object)({id:(0,r.union)([(0,r.number)(),(0,r.string)()]),type:(0,r.string)(),key:(0,r.string)(),value:(0,r.union)([(0,r.number)(),(0,r.string)(),(0,r.boolean)(),(0,r.object)()])}),this.campaignVariationSchema=(0,r.object)({id:(0,r.union)([(0,r.number)(),(0,r.string)()]),name:(0,r.string)(),weight:(0,r.union)([(0,r.number)(),(0,r.string)()]),segments:(0,r.optional)((0,r.object)()),variables:(0,r.optional)((0,r.array)(this.variableObjectSchema)),startRangeVariation:(0,r.optional)((0,r.number)()),endRangeVariation:(0,r.optional)((0,r.number)()),salt:(0,r.optional)((0,r.string)())}),this.campaignObjectSchema=(0,r.object)({id:(0,r.union)([(0,r.number)(),(0,r.string)()]),type:(0,r.string)(),key:(0,r.string)(),percentTraffic:(0,r.optional)((0,r.number)()),status:(0,r.string)(),variations:(0,r.array)(this.campaignVariationSchema),segments:(0,r.object)(),isForcedVariationEnabled:(0,r.optional)((0,r.boolean)()),isAlwaysCheckSegment:(0,r.optional)((0,r.boolean)()),name:(0,r.string)(),salt:(0,r.optional)((0,r.string)())}),this.ruleSchema=(0,r.object)({type:(0,r.string)(),ruleKey:(0,r.string)(),campaignId:(0,r.number)(),variationId:(0,r.optional)((0,r.number)())}),this.featureSchema=(0,r.object)({id:(0,r.union)([(0,r.number)(),(0,r.string)()]),key:(0,r.string)(),status:(0,r.string)(),name:(0,r.string)(),type:(0,r.string)(),metrics:(0,r.array)(this.campaignMetricSchema),impactCampaign:(0,r.optional)((0,r.object)()),rules:(0,r.optional)((0,r.array)(this.ruleSchema)),variables:(0,r.optional)((0,r.array)(this.variableObjectSchema))}),this.settingsSchema=(0,r.object)({sdkKey:(0,r.optional)((0,r.string)()),version:(0,r.union)([(0,r.number)(),(0,r.string)()]),accountId:(0,r.union)([(0,r.number)(),(0,r.string)()]),features:(0,r.optional)((0,r.array)(this.featureSchema)),campaigns:(0,r.array)(this.campaignObjectSchema),groups:(0,r.optional)((0,r.object)()),campaignGroups:(0,r.optional)((0,r.object)()),collectionPrefix:(0,r.optional)((0,r.string)())})},e.prototype.isSettingsValid=function(e){return!!e&&!(0,r.validate)(e,this.settingsSchema)[0]},e}();t.SettingsSchema=o},5692:e=>{e.exports=require("https")},5810:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SetAttributeApi=void 0;var a=n(7111),i=n(1943),s=n(5946),u=function(){function e(){}return e.prototype.setAttribute=function(e,t,n){return r(this,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return(0,i.getShouldWaitForTrackingCalls)()?[4,c(e,t,n)]:[3,2];case 1:return r.sent(),[3,3];case 2:c(e,t,n),r.label=3;case 3:return[2]}}))}))},e}();t.SetAttributeApi=u;var c=function(e,t,n){return r(void 0,void 0,void 0,(function(){var r,u;return o(this,(function(o){switch(o.label){case 0:return r=(0,i.getEventsBaseProperties)(a.EventEnum.VWO_SYNC_VISITOR_PROP,encodeURIComponent(n.getUserAgent()),n.getIpAddress()),u=(0,i.getAttributePayloadData)(e,n.getId(),a.EventEnum.VWO_SYNC_VISITOR_PROP,t,n.getUserAgent(),n.getIpAddress()),s.BatchEventsQueue.Instance?(s.BatchEventsQueue.Instance.enqueue(u),[3,3]):[3,1];case 1:return[4,(0,i.sendPostApiRequest)(r,u,n.getId())];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))}},5946:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.BatchEventsQueue=void 0;var a=n(477),i=n(7173),s=n(6178),u=n(5076),c=n(2974),l=n(9600),g=function(){function e(t){return void 0===t&&(t={}),this.queue=[],this.timer=null,(0,i.isNumber)(t.requestTimeInterval)&&t.requestTimeInterval>=1?this.requestTimeInterval=t.requestTimeInterval:(this.requestTimeInterval=a.Constants.DEFAULT_REQUEST_TIME_INTERVAL,s.LogManager.Instance.info((0,u.buildMessage)(c.InfoLogMessagesEnum.EVENT_BATCH_DEFAULTS,{parameter:"requestTimeInterval",minLimit:0,defaultValue:this.requestTimeInterval.toString()}))),(0,i.isNumber)(t.eventsPerRequest)&&t.eventsPerRequest>0&&t.eventsPerRequest<=a.Constants.MAX_EVENTS_PER_REQUEST?this.eventsPerRequest=t.eventsPerRequest:t.eventsPerRequest>a.Constants.MAX_EVENTS_PER_REQUEST?(this.eventsPerRequest=a.Constants.MAX_EVENTS_PER_REQUEST,s.LogManager.Instance.info((0,u.buildMessage)(c.InfoLogMessagesEnum.EVENT_BATCH_MAX_LIMIT,{parameter:"eventsPerRequest",maxLimit:a.Constants.MAX_EVENTS_PER_REQUEST.toString()}))):(this.eventsPerRequest=a.Constants.DEFAULT_EVENTS_PER_REQUEST,s.LogManager.Instance.info((0,u.buildMessage)(c.InfoLogMessagesEnum.EVENT_BATCH_DEFAULTS,{parameter:"eventsPerRequest",minLimit:0,defaultValue:this.eventsPerRequest.toString()}))),this.flushCallback=(0,i.isFunction)(t.flushCallback)?t.flushCallback:function(){},this.dispatcher=t.dispatcher,this.accountId=l.SettingsService.Instance.accountId,this.createNewBatchTimer(),e.instance=this,this}return Object.defineProperty(e,"Instance",{get:function(){return e.instance},enumerable:!1,configurable:!0}),e.prototype.enqueue=function(e){this.queue.push(e),s.LogManager.Instance.info((0,u.buildMessage)(c.InfoLogMessagesEnum.EVENT_QUEUE,{queueType:"batch",event:JSON.stringify(e)})),this.queue.length>=this.eventsPerRequest&&this.flush()},e.prototype.flush=function(e){var t=this;if(void 0===e&&(e=!1),this.queue.length){s.LogManager.Instance.debug((0,u.buildMessage)(c.DebugLogMessagesEnum.EVENT_BATCH_BEFORE_FLUSHING,{manually:e?"manually":"",length:this.queue.length,accountId:this.accountId,timer:e?"Timer will be cleared and registered again":""}));var n=this.queue;return this.queue=[],this.dispatcher(n,this.flushCallback).then((function(r){var o;return"success"===r.status?(s.LogManager.Instance.info((0,u.buildMessage)(c.InfoLogMessagesEnum.EVENT_BATCH_After_FLUSHING,{manually:e?"manually":"",length:n.length})),r):((o=t.queue).push.apply(o,n),r)})).catch((function(){var e;return(e=t.queue).push.apply(e,n),{status:"error",events:n}}))}return s.LogManager.Instance.debug((0,u.buildMessage)(c.DebugLogMessagesEnum.BATCH_QUEUE_EMPTY)),new Promise((function(e){e({status:"success",events:[]})}))},e.prototype.createNewBatchTimer=function(){var e=this;this.timer=setInterval((function(){return r(e,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.flush()];case 1:return e.sent(),[2]}}))}))}),1e3*this.requestTimeInterval)},e.prototype.clearRequestTimer=function(){clearTimeout(this.timer),this.timer=null},e.prototype.flushAndClearTimer=function(){return this.flush(!0)},e}();t.BatchEventsQueue=g,t.default=g},6089:e=>{e.exports=JSON.parse('{"name":"vwo-fme-node-sdk","version":"1.20.2","description":"VWO Node/JavaScript SDK for Feature Management and Experimentation","main":"dist/server/vwo-fme-node-sdk.min.js","browser":"dist/client/vwo-fme-javascript-sdk.min.js","exports":{".":{"node":{"types":"./dist/types/index.d.ts","import":"./dist/server/vwo-fme-node-sdk.min.js","require":"./dist/server/vwo-fme-node-sdk.min.js","default":"./dist/server/vwo-fme-node-sdk.min.js"},"default":{"types":"./dist/types/index.d.ts","import":"./dist/client/vwo-fme-javascript-sdk.js","require":"./dist/client/vwo-fme-javascript-sdk.min.js","default":"./dist/client/vwo-fme-javascript-sdk.min.js"}},"./node":{"types":"./dist/types/index.d.ts","import":"./dist/server/vwo-fme-node-sdk.min.js","require":"./dist/server/vwo-fme-node-sdk.min.js","default":"./dist/server/vwo-fme-node-sdk.min.js"},"./browser":{"types":"./dist/types/index.d.ts","import":"./dist/client/vwo-fme-javascript-sdk.js","require":"./dist/client/vwo-fme-javascript-sdk.min.js","default":"./dist/client/vwo-fme-javascript-sdk.min.js"}},"types":"dist/types/index.d.ts","scripts":{"build":"rm -rf dist/ yarn tsc:prod && yarn build:node && yarn build:browser && prettier -w dist/types/","build:browser":"yarn build:dev-browser && yarn build:prod-browser","build:node":"yarn build:dev-node && yarn build:prod-node","build:dev-browser":"webpack --config ./webpack.browser.config.js --mode=development","build:dev-node":"yarn tsc:prod && webpack --config ./webpack.node.config.js --mode=development","build:dev-browser-watch":"webpack --config ./webpack.browser.config.js --mode=development --watch","build:dev-node-watch":"yarn tsc:prod && webpack --config ./webpack.node.config.js --mode=development --watch","build:dev-browser-analyze":"webpack --config ./webpack.browser.config.js --mode=development --env analyze=1","build:dev-node-analyze":"yarn tsc:prod && webpack --config ./webpack.node.config.js --mode=production --env analyze=1","build:prod-browser":"webpack --config ./webpack.browser.config.js --mode=production","build:prod-node":"yarn tsc:prod && webpack --config ./webpack.node.config.js --mode=production","check:license":"yarn check:versions && node -e \'require(\\"./scripts/check-license\\")\'","check:versions":"node -e \'require(\\"./scripts/check-versions\\")\'","demo":"nodemon --inspect=0.0.0.0:9229 --legacy-watch --ignore node_modules demo/index.js","demo:server":"nodemon --inspect=0.0.0.0:9229 --legacy-watch --ignore node_modules demo/server.js","lint":"node -e \'require(\\"./scripts/check-versions\\")([\\"nodeLint\\"])\' && eslint lib/ --fix","lint:errors-only":"node -e \'require(\\"./scripts/check-versions\\")([\\"nodeLint\\"])\' && eslint **/*.ts\' --fix --quiet","prepare":"husky","prettier":"prettier -w lib/**/*.ts *.md","test:dev":"node --inspect-brk node_modules/jest/bin/jest.js --watch --runInBand --debug --colors --errorOnDeprecated","test:prod":"jest --runInBand --colors --errorOnDeprecated","test:coverage":"jest --coverage --coverageDirectory=coverage && cat ./coverage/lcov.info","tsc":"yarn check:versions && rm -rf dist/server-unpacked && cp package.json dist/ && tsc -w","tsc:prod":"yarn check:versions && rm -rf dist/server-unpacked && tsc && cp package.json dist/","typedoc":"typedoc --plugin typedoc-plugin-markdown --out ./docs lib/*.ts lib/**/*.ts lib/**/**/*.ts ","typedoc:html":"typedoc --out docs-html lib/*.ts lib/**/*.ts lib/**/**/*.ts"},"repository":{"type":"git","url":"https://github.com/wingify/vwo-fme-node-sdk"},"author":"VWO developers","license":"Apache-2.0","files":["dist/","package.json","yarn.lock","lib/**/*","LICENSE","README.md","CONTRIBUTING.md","CHANGELOG.md","NOTICE"],"dependencies":{"murmurhash":"^2.0.1","superstruct":"^0.14.x","uuid":"^9.0.1","vwo-fme-sdk-log-messages":"^1.*.*"},"devDependencies":{"@babel/core":"^7.24.5","@babel/preset-env":"^7.24.5","@babel/preset-typescript":"^7.24.1","@commitlint/cli":"^19.3.0","@commitlint/config-conventional":"^19.2.2","@eslint/js":"^9.2.0","@types/jest":"^29.5.12","@types/node":"^20.12.7","babel-jest":"^29.7.0","babel-loader":"^9.1.3","eslint":"^9.2.0","globals":"^15.1.0","husky":"^9.0.11","jest":"^29.7.0","lint-staged":"^15.2.2","nodemon":"^2.0.6","prettier":"^3.2.5","semver":"^7.6.0","shelljs":"^0.8.5","ts-loader":"^9.5.1","typedoc":"^0.25.13","typescript":"^5.4.5","typescript-eslint":"^7.8.0","vwo-fme-sdk-e2e-test-settings-n-cases":"^1.4.0","webpack":"^5.91.0","webpack-bundle-analyzer":"^4.10.2","webpack-cli":"^5.1.4","webpack-node-externals":"^3.0.0"},"lint-staged":{"**/*.{ts,json,md}":["prettier --write"]},"engineStrict":true,"engines":{"node":">= 8.9.0","yarn":">= 1.22.17"},"customEngines":{"nodeLint":">= 18.18.0"}}')},6096:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UrlUtil=void 0;var r=n(477),o=n(9600),a=n(7173);t.UrlUtil={init:function(e){var n=(void 0===e?{}:e).collectionPrefix;return n&&(0,a.isString)(n)&&(t.UrlUtil.collectionPrefix=n),t.UrlUtil},getBaseUrl:function(){var e=o.SettingsService.Instance.hostname;return o.SettingsService.Instance.isGatewayServiceProvided,e},getUpdatedBaseUrl:function(e){return t.UrlUtil.collectionPrefix&&e===r.Constants.HOST_NAME?"".concat(e,"/").concat(t.UrlUtil.collectionPrefix):e}}},6167:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ApiEnum=void 0,function(e){e.INIT="init",e.ON_INIT="onInit",e.GET_FLAG="getFlag",e.TRACK_EVENT="trackEvent",e.SET_ATTRIBUTE="setAttribute",e.FLUSH_EVENTS="flushEvents",e.UPDATE_SETTINGS="updateSettings"}(n||(t.ApiEnum=n={}))},6178:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LogLevelEnum=t.LogManager=void 0;var r=n(7623);Object.defineProperty(t,"LogManager",{enumerable:!0,get:function(){return r.LogManager}});var o=n(8858);Object.defineProperty(t,"LogLevelEnum",{enumerable:!0,get:function(){return o.LogLevelEnum}})},6190:e=>{e.exports=require("superstruct")},6254:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateGroups=void 0,t.getFeatureKeysFromGroup=b;var a=n(477),i=n(834),s=n(6947),u=n(2974),c=n(8198),l=n(1463),g=n(6365),p=n(6178),d=n(3991),f=n(689),h=n(5479),v=n(7173),m=n(9455),y=n(8470),E=n(5076);function b(e,t){var n=(0,h.getCampaignsByGroupId)(e,t);return{featureKeys:(0,h.getFeatureKeysFromCampaignIds)(e,n),groupCampaignIds:n}}t.evaluateGroups=function(e,t,n,a,i,s){return r(void 0,void 0,void 0,(function(){var r,u,c,l,g,p,d,f,h,v,m,E;return o(this,(function(_){switch(_.label){case 0:r=[],u=new Map,c=b(e,n),l=c.featureKeys,g=c.groupCampaignIds,p=function(t){var n;return o(this,(function(o){switch(o.label){case 0:return n=(0,y.getFeatureFromKey)(e,t),r.includes(t)?[2,"continue"]:[4,I(e,n,a,r,s,i)];case 1:return o.sent()&&e.getFeatures().forEach((function(e){e.getKey()===t&&e.getRulesLinkedCampaign().forEach((function(e){(g.includes(e.getId().toString())||g.includes("".concat(e.getId(),"_").concat(e.getVariations()[0].getId()).toString()))&&(u.has(t)||u.set(t,[]),-1===u.get(t).findIndex((function(t){return t.ruleKey===e.getRuleKey()}))&&u.get(t).push(e))}))})),[2]}}))},d=0,f=l,_.label=1;case 1:return d<f.length?(h=f[d],[5,p(h)]):[3,4];case 2:_.sent(),_.label=3;case 3:return d++,[3,1];case 4:return[4,S(e,u,i,s)];case 5:return v=_.sent(),m=v.eligibleCampaigns,E=v.eligibleCampaignsWithStorage,[4,T(e,t.getKey(),m,E,n,i,s)];case 6:return[2,_.sent()]}}))}))};var I=function(e,t,n,a,i,l){return r(void 0,void 0,void 0,(function(){var r,g,d,h,b,I,S;return o(this,(function(o){switch(o.label){case 0:if(n.has(t.getKey())&&"rolloutId"in n.get(t.getKey()))return[2,!0];if(!((r=(0,y.getSpecificRulesBasedOnType)(t,s.CampaignTypeEnum.ROLLOUT)).length>0))return[3,5];g=null,d=0,h=r,o.label=1;case 1:return d<h.length?(b=h[d],[4,(0,f.evaluateRule)(e,t,b,l,n,null,i,{})]):[3,4];case 2:return o.sent().preSegmentationResult?(g=b,[3,4]):[3,3];case 3:return d++,[3,1];case 4:return null!==g&&(I=(new c.CampaignModel).modelFromDictionary(g),S=(0,m.evaluateTrafficAndGetVariation)(e,I,l.getId()),(0,v.isObject)(S)&&Object.keys(S).length>0)?(n.set(t.getKey(),{rolloutId:g.id,rolloutKey:g.key,rolloutVariationId:g.variations[0].id}),[2,!0]):(a.push(t.getKey()),[2,!1]);case 5:return p.LogManager.Instance.info((0,E.buildMessage)(u.InfoLogMessagesEnum.MEG_SKIP_ROLLOUT_EVALUATE_EXPERIMENTS,{featureKey:t.getKey()})),[2,!0]}}))}))},S=function(e,t,n,a){return r(void 0,void 0,void 0,(function(){var r,l,g,f,v,m,y,b,I,S,T,_,O;return o(this,(function(M){switch(M.label){case 0:r=[],l=[],g=[],f=Array.from(t),v=0,m=f,M.label=1;case 1:if(!(v<m.length))return[3,6];y=m[v],b=y[0],I=y[1],S=function(t){var f;return o(this,(function(o){switch(o.label){case 0:return[4,(new i.StorageDecorator).getFeatureFromStorage(b,n,a)];case 1:return(null==(f=o.sent())?void 0:f.experimentVariationId)&&f.experimentKey&&f.experimentKey===t.getKey()&&(0,h.getVariationFromCampaignKey)(e,f.experimentKey,f.experimentVariationId)?(p.LogManager.Instance.info((0,E.buildMessage)(u.InfoLogMessagesEnum.MEG_CAMPAIGN_FOUND_IN_STORAGE,{campaignKey:f.experimentKey,userId:n.getId()})),-1===l.findIndex((function(e){return e.key===t.getKey()}))&&l.push(t),[2,"continue"]):[4,(new d.CampaignDecisionService).getPreSegmentationDecision((new c.CampaignModel).modelFromDictionary(t),n)];case 2:return o.sent()&&(new d.CampaignDecisionService).isUserPartOfCampaign(n.getId(),t)?(p.LogManager.Instance.info((0,E.buildMessage)(u.InfoLogMessagesEnum.MEG_CAMPAIGN_ELIGIBLE,{campaignKey:t.getType()===s.CampaignTypeEnum.AB?t.getKey():t.getName()+"_"+t.getRuleKey(),userId:n.getId()})),r.push(t),[2,"continue"]):(g.push(t),[2])}}))},T=0,_=I,M.label=2;case 2:return T<_.length?(O=_[T],[5,S(O)]):[3,5];case 3:M.sent(),M.label=4;case 4:return T++,[3,2];case 5:return v++,[3,1];case 6:return[2,Promise.resolve({eligibleCampaigns:r,eligibleCampaignsWithStorage:l,inEligibleCampaigns:g})]}}))}))},T=function(e,t,n,i,c,l,g){return r(void 0,void 0,void 0,(function(){var r,d,f,m;return o(this,(function(o){return r=null,d=(0,h.getCampaignIdsFromFeatureKey)(e,t),f=(0,v.isUndefined)(null===(m=null==e?void 0:e.getGroups()[c])||void 0===m?void 0:m.et)?a.Constants.RANDOM_ALGO:e.getGroups()[c].et,1===i.length?(r=i[0],p.LogManager.Instance.info((0,E.buildMessage)(u.InfoLogMessagesEnum.MEG_WINNER_CAMPAIGN,{campaignKey:i[0].getType()===s.CampaignTypeEnum.AB?i[0].getKey():i[0].getName()+"_"+i[0].getRuleKey(),groupId:c,userId:l.getId(),algo:""}))):i.length>1&&f===a.Constants.RANDOM_ALGO?r=_(i,l,d,c,g):i.length>1&&(r=O(e,i,l,d,c,g)),0===i.length&&(1===n.length?(r=n[0],p.LogManager.Instance.info((0,E.buildMessage)(u.InfoLogMessagesEnum.MEG_WINNER_CAMPAIGN,{campaignKey:n[0].getType()===s.CampaignTypeEnum.AB?n[0].getKey():n[0].getName()+"_"+n[0].getRuleKey(),groupId:c,userId:l.getId(),algo:""}))):n.length>1&&f===a.Constants.RANDOM_ALGO?r=_(n,l,d,c,g):n.length>1&&(r=O(e,n,l,d,c,g))),[2,r]}))}))},_=function(e,t,n,r,o){e.forEach((function(t){t.weight=Math.round(100/e.length*1e4)/1e4})),e=e.map((function(e){return(new l.VariationModel).modelFromDictionary(e)})),(0,h.setCampaignAllocation)(e);var c=(new d.CampaignDecisionService).getVariation(e,(new g.DecisionMaker).calculateBucketValue((0,h.getBucketingSeed)(t.getId(),void 0,r)));return p.LogManager.Instance.info((0,E.buildMessage)(u.InfoLogMessagesEnum.MEG_WINNER_CAMPAIGN,{campaignKey:c.getType()===s.CampaignTypeEnum.AB?c.getKey():c.getKey()+"_"+c.getRuleKey(),groupId:r,userId:t.getId(),algo:"using random algorithm"})),c&&((new i.StorageDecorator).setDataInStorage({featureKey:"".concat(a.Constants.VWO_META_MEG_KEY).concat(r),context:t,experimentId:c.getId(),experimentKey:c.getKey(),experimentVariationId:c.getType()===s.CampaignTypeEnum.PERSONALIZE?c.getVariations()[0].getId():-1},o),n.includes(c.getId()))?c:null},O=function(e,t,n,r,o,c){for(var f=null,m=!1,b=(0,v.isUndefined)(e.getGroups()[o].p)?{}:e.getGroups()[o].p,I=(0,v.isUndefined)(e.getGroups()[o].wt)?{}:e.getGroups()[o].wt,S=0;S<b.length;S++){for(var T=0;T<t.length;T++){if(t[T].id==b[S]){f=(0,y.cloneObject)(t[T]),m=!0;break}if(t[T].id+"_"+t[T].variations[0].id===b[S]){f=(0,y.cloneObject)(t[T]),m=!0;break}}if(!0===m)break}if(null===f){var _=[];for(S=0;S<t.length;S++){var O=t[S].id;if((0,v.isUndefined)(I[O])){if(!(0,v.isUndefined)(I[O+"_"+t[S].variations[0].id])){var M;(M=(0,y.cloneObject)(t[S])).weight=I[O+"_"+t[S].variations[0].id],_.push(M)}}else(M=(0,y.cloneObject)(t[S])).weight=I[O],_.push(M)}_=_.map((function(e){return(new l.VariationModel).modelFromDictionary(e)})),(0,h.setCampaignAllocation)(_),f=(new d.CampaignDecisionService).getVariation(_,(new g.DecisionMaker).calculateBucketValue((0,h.getBucketingSeed)(n.getId(),void 0,o)))}return f?p.LogManager.Instance.info((0,E.buildMessage)(u.InfoLogMessagesEnum.MEG_WINNER_CAMPAIGN,{campaignKey:f.type===s.CampaignTypeEnum.AB?f.key:f.key+"_"+f.ruleKey,groupId:o,userId:n.getId(),algo:"using advanced algorithm"})):p.LogManager.Instance.info("No winner campaign found for MEG group: ".concat(o)),f&&((new i.StorageDecorator).setDataInStorage({featureKey:"".concat(a.Constants.VWO_META_MEG_KEY).concat(o),context:n,experimentId:f.id,experimentKey:f.key,experimentVariationId:f.type===s.CampaignTypeEnum.PERSONALIZE?f.variations[0].id:-1},c),r.includes(f.id))?f:null}},6365:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DecisionMaker=void 0;var r=n(9708),o=function(){function e(){}return e.prototype.generateBucketValue=function(e,t,n){void 0===n&&(n=1);var r=(t*(e/Math.pow(2,32))+1)*n;return Math.floor(r)},e.prototype.getBucketValueForUser=function(e,t){void 0===t&&(t=100);var n=r.v3(e,1);return this.generateBucketValue(n,t)},e.prototype.calculateBucketValue=function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=1e4);var r=this.generateHashValue(e);return this.generateBucketValue(r,n,t)},e.prototype.generateHashValue=function(e){return r.v3(e,1)},e}();t.DecisionMaker=o},6787:(e,t,n)=>{t._=void 0;var r=n(8611),o=n(5692),a=n(5576),i=n(3388),s=n(3647),u=n(477),c=n(6178),l=n(5076),g=n(2974),p=function(){function e(){}return e.prototype.GET=function(e){var t=this,n=function(u){var c=new a.Deferred,l=e.getOptions(),g=new s.ResponseModel;try{var p=(l.scheme===i.HTTPS?o:r).get(l,(function(e){g.setStatusCode(e.statusCode);var r,o=e.headers["content-type"],a="";if(/^application\/json/.test(o)||(r="Invalid content-type.\nExpected application/json but received ".concat(o,". Status Code: ").concat(null==e?void 0:e.statusCode)),r)return e.resume(),t.retryOrReject(r,u,c,String(l.path).split("?")[0],n);e.setEncoding("utf8"),e.on("data",(function(e){a+=e})),e.on("end",(function(){try{var e=JSON.parse(a);if(g.getStatusCode()<200||g.getStatusCode()>=300){var r="".concat(a,", Status Code: ").concat(g.getStatusCode());return 400===g.getStatusCode()?(g.setError(r),void c.reject(g)):t.retryOrReject(r,u,c,String(l.path).split("?")[0],n)}g.setData(e),c.resolve(g)}catch(e){return t.retryOrReject(e,u,c,String(l.path).split("?")[0],n)}}))}));p.on("timeout",(function(){return t.retryOrReject(new Error("timeout"),u,c,String(l.path).split("?")[0],n)})),p.on("error",(function(e){return t.retryOrReject(e,u,c,String(l.path).split("?")[0],n)}))}catch(e){t.retryOrReject(e,u,c,String(l.path).split("?")[0],n)}return c.promise};return n(0)},e.prototype.POST=function(e){var t=this,n=function(u){var c=new a.Deferred,l=e.getOptions(),g=new s.ResponseModel;try{var p=(l.scheme===i.HTTPS?o:r).request(l,(function(r){var o="";r.setEncoding("utf8"),r.on("data",(function(e){o+=e})),r.on("end",(function(){try{if(200!==r.statusCode){var a="Raw Data: ".concat(o,", Status Code: ").concat(r.statusCode);return g.setStatusCode(r.statusCode),400===r.statusCode?(g.setError(a),void c.reject(g)):t.retryOrReject(a,u,c,String(l.path).split("?")[0],n)}g.setStatusCode(r.statusCode),g.setData(e.getBody()),c.resolve(g)}catch(e){return t.retryOrReject(e,u,c,String(l.path).split("?")[0],n)}}))}));p.on("timeout",(function(){var e="Timeout: ".concat(l.timeout);return t.retryOrReject(e,u,c,String(l.path).split("?")[0],n)})),p.on("error",(function(e){return t.retryOrReject(e,u,c,String(l.path).split("?")[0],n)})),p.write(JSON.stringify(l.body)),p.end()}catch(e){t.retryOrReject(e,u,c,String(l.path).split("?")[0],n)}return c.promise};return n(0)},e.prototype.retryOrReject=function(e,t,n,r,o){var a=u.Constants.RETRY_DELAY*Math.pow(2,t+1);if(t<u.Constants.MAX_RETRIES)c.LogManager.Instance.error((0,l.buildMessage)(g.ErrorLogMessagesEnum.NETWORK_CALL_RETRY_ATTEMPT,{endPoint:r,err:e,delay:a/1e3,attempt:t+1,maxRetries:u.Constants.MAX_RETRIES})),setTimeout((function(){o(t+1).then(n.resolve).catch(n.reject)}),a);else{c.LogManager.Instance.error((0,l.buildMessage)(g.ErrorLogMessagesEnum.NETWORK_CALL_RETRY_FAILED,{endPoint:r,err:e}));var i=new s.ResponseModel;i.setError(e),n.reject(i)}},e}();t._=p},6826:e=>{e.exports=require("vwo-fme-sdk-log-messages")},6947:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.CampaignTypeEnum=void 0,function(e){e.ROLLOUT="FLAG_ROLLOUT",e.AB="FLAG_TESTING",e.PERSONALIZE="FLAG_PERSONALIZE"}(n||(t.CampaignTypeEnum=n={}))},6977:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.BatchEventsDispatcher=void 0;var a=n(4464),i=n(6096),s=n(4464),u=n(5212),c=n(2478),l=n(9600),g=n(6178),p=n(5076),d=n(2974),f=n(7173),h=n(5576),v=function(){function e(){}return e.dispatch=function(e,t,n){return r(this,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,this.sendPostApiRequest(n,e,t)];case 1:return[2,r.sent()]}}))}))},e.sendPostApiRequest=function(e,t,n){return r(this,void 0,void 0,(function(){var r,g,p,d,f,v,m;return o(this,(function(o){switch(o.label){case 0:r=new h.Deferred,s.NetworkManager.Instance.attachClient(),(g={}).Authorization=l.SettingsService.Instance.sdkKey,p=i.UrlUtil.getBaseUrl(),p=i.UrlUtil.getUpdatedBaseUrl(p),d=new a.RequestModel(p,u.HttpMethodEnum.POST,c.UrlEnum.BATCH_EVENTS,e,t,g,l.SettingsService.Instance.protocol,l.SettingsService.Instance.port),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,s.NetworkManager.Instance.post(d)];case 2:return f=o.sent(),m=this.handleBatchResponse(c.UrlEnum.BATCH_EVENTS,t,e,null,f,n),r.resolve(m),[2,r.promise];case 3:return v=o.sent(),m=this.handleBatchResponse(c.UrlEnum.BATCH_EVENTS,t,e,v,null,n),r.resolve(m),[2,r.promise];case 4:return[2]}}))}))},e.handleBatchResponse=function(e,t,n,r,o,a){var i=t.ev.length,s=n.a,c=r||(null==o?void 0:o.getError());if(!c||c instanceof Error||((0,f.isString)(c)?c=new Error(c):c instanceof Object&&(c=new Error(JSON.stringify(c)))),c)return g.LogManager.Instance.info((0,p.buildMessage)(d.InfoLogMessagesEnum.IMPRESSION_BATCH_FAILED)),g.LogManager.Instance.error((0,p.buildMessage)(d.ErrorLogMessagesEnum.NETWORK_CALL_FAILED,{method:u.HttpMethodEnum.POST,err:c.message})),a(c,t),{status:"error",events:t};var l=null==o?void 0:o.getStatusCode();return 200===l?(g.LogManager.Instance.info((0,p.buildMessage)(d.InfoLogMessagesEnum.IMPRESSION_BATCH_SUCCESS,{accountId:s,endPoint:e})),a(null,t),{status:"success",events:t}):413===l?(g.LogManager.Instance.error((0,p.buildMessage)(d.ErrorLogMessagesEnum.CONFIG_BATCH_EVENT_LIMIT_EXCEEDED,{accountId:s,endPoint:e,eventsPerRequest:i})),g.LogManager.Instance.error((0,p.buildMessage)(d.ErrorLogMessagesEnum.NETWORK_CALL_FAILED,{method:u.HttpMethodEnum.POST,err:c.message})),a(c,t),{status:"error",events:t}):(g.LogManager.Instance.error((0,p.buildMessage)(d.ErrorLogMessagesEnum.IMPRESSION_BATCH_FAILED)),g.LogManager.Instance.error((0,p.buildMessage)(d.ErrorLogMessagesEnum.NETWORK_CALL_FAILED,{method:u.HttpMethodEnum.POST,err:c.message})),a(c,t),{status:"error",events:t})},e}();t.BatchEventsDispatcher=v,t.default=v},7005:(e,t,n)=>{t.o=void 0;var r=n(4868),o=n(5576),a=n(3647),i=function(){function e(){}return e.prototype.GET=function(e){var t=new o.Deferred,n=e.getOptions(),i=new a.ResponseModel;return(0,r.sendGetCall)({networkOptions:n,successCallback:function(e){i.setData(e),t.resolve(i)},errorCallback:function(e){i.setError(e),t.reject(i)}}),t.promise},e.prototype.POST=function(e){var t=new o.Deferred,n=e.getOptions(),i=new a.ResponseModel;return(0,r.sendPostCall)({networkOptions:n,successCallback:function(e){i.setStatusCode(200),i.setData(e),t.resolve(i)},errorCallback:function(e){i.setStatusCode(400),i.setError(e),t.reject(i)}}),t.promise},e}();t.o=i},7111:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.EventEnum=void 0,function(e){e.VWO_VARIATION_SHOWN="vwo_variationShown",e.VWO_SYNC_VISITOR_PROP="vwo_syncVisitorProp",e.VWO_LOG_EVENT="vwo_log"}(n||(t.EventEnum=n={}))},7131:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getKeyValue=function(e){if((0,r.isObject)(e)){var t=Object.keys(e)[0];return{key:t,value:e[t]}}},t.matchWithRegex=function(e,t){try{return e.match(new RegExp(t))}catch(e){return null}};var r=n(7173)},7173:(e,t)=>{function n(e){return"[object Object]"===Object.prototype.toString.call(e)}function r(e){return"[object Array]"===Object.prototype.toString.call(e)}function o(e){return"[object Null]"===Object.prototype.toString.call(e)}function a(e){return"[object Undefined]"===Object.prototype.toString.call(e)}function i(e){return"[object Number]"===Object.prototype.toString.call(e)}function s(e){return"[object String]"===Object.prototype.toString.call(e)}function u(e){return"[object Boolean]"===Object.prototype.toString.call(e)}function c(e){return"[object Function]"===Object.prototype.toString.call(e)}function l(e){return"[object Promise]"===Object.prototype.toString.call(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isObject=n,t.isArray=r,t.isNull=o,t.isUndefined=a,t.isNumber=i,t.isString=s,t.isBoolean=u,t.isFunction=c,t.isPromise=l,t.getType=function(e){return n(e)?"Object":r(e)?"Array":o(e)?"Null":a(e)?"Undefined":i(e)?"Number":s(e)?"String":u(e)?"Boolean":c(e)?"Function":l(e)?"Promise":"Unknown Type"}},7385:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SegmentEvaluator=void 0;var a=n(834),i=n(6178),s=n(1566),u=n(7173),c=n(2106),l=n(7131),g=n(3904),p=function(){function e(){}return e.prototype.isSegmentationValid=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a,i;return o(this,(function(o){switch(o.label){case 0:switch(n=(0,l.getKeyValue)(e),r=n.key,a=n.value,i=a,r){case c.SegmentOperatorValueEnum.NOT:return[3,1];case c.SegmentOperatorValueEnum.AND:return[3,3];case c.SegmentOperatorValueEnum.OR:return[3,5];case c.SegmentOperatorValueEnum.CUSTOM_VARIABLE:return[3,7];case c.SegmentOperatorValueEnum.USER:return[3,9];case c.SegmentOperatorValueEnum.UA:return[3,10]}return[3,11];case 1:return[4,this.isSegmentationValid(i,t)];case 2:return[2,!o.sent()];case 3:return[4,this.every(i,t)];case 4:case 6:case 8:return[2,o.sent()];case 5:return[4,this.some(i,t)];case 7:return[4,(new g.SegmentOperandEvaluator).evaluateCustomVariableDSL(i,t)];case 9:return[2,(new g.SegmentOperandEvaluator).evaluateUserDSL(i,t)];case 10:return[2,(new g.SegmentOperandEvaluator).evaluateUserAgentDSL(i,this.context)];case 11:return[2,!1]}}))}))},e.prototype.some=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a,s,u,l,g,p,d,f,h,v,m,y;return o(this,(function(E){switch(E.label){case 0:n={},r=0,a=!1,s=0,u=e,E.label=1;case 1:if(!(s<u.length))return[3,12];for(h in l=u[s],g=function(e){var t,s,u,g,d,f,h,v;return o(this,(function(o){switch(o.label){case 0:return e!==c.SegmentOperatorValueEnum.OPERATING_SYSTEM&&e!==c.SegmentOperatorValueEnum.BROWSER_AGENT&&e!==c.SegmentOperatorValueEnum.DEVICE_TYPE&&e!==c.SegmentOperatorValueEnum.DEVICE||(a=!0,t=l[e],n[e]||(n[e]=[]),(Array.isArray(t)?t:[t]).forEach((function(t){"string"==typeof t&&n[e].push(t)})),r++),e!==c.SegmentOperatorValueEnum.FEATURE_ID?[3,3]:(s=l[e],u=Object.keys(s)[0],"on"!==(g=s[u])&&"off"!==g?[3,3]:(d=p.settings.getFeatures(),(f=d.find((function(e){return e.getId()===parseInt(u)})))?(h=f.getKey(),[4,p.checkInUserStorage(p.settings,h,p.context)]):[3,2]));case 1:return v=o.sent(),"off"===g?[2,{value:!v}]:[2,{value:v}];case 2:return i.LogManager.Instance.error("Feature not found with featureIdKey: "+u),[2,{value:null}];case 3:return[2]}}))},p=this,f=[],d=l)f.push(h);v=0,E.label=2;case 2:return v<f.length?(h=f[v])in d?[5,g(h)]:[3,4]:[3,5];case 3:if("object"==typeof(m=E.sent()))return[2,m.value];E.label=4;case 4:return v++,[3,2];case 5:if(!a||r!==e.length)return[3,9];E.label=6;case 6:return E.trys.push([6,8,,9]),[4,this.checkUserAgentParser(n)];case 7:return[2,E.sent()];case 8:return y=E.sent(),i.LogManager.Instance.error("Failed to validate User Agent. Erro: "+y),[3,9];case 9:return[4,this.isSegmentationValid(l,t)];case 10:if(E.sent())return[2,!0];E.label=11;case 11:return s++,[3,1];case 12:return[2,!1]}}))}))},e.prototype.every=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a,i;return o(this,(function(o){switch(o.label){case 0:n={},r=0,a=e,o.label=1;case 1:return r<a.length?(i=a[r],c.SegmentOperatorValueEnum.COUNTRY in i||c.SegmentOperatorValueEnum.REGION in i||c.SegmentOperatorValueEnum.CITY in i?(this.addLocationValuesToMap(i,n),Object.keys(n).length!==e.length?[3,3]:[4,this.checkLocationPreSegmentation(n)]):[3,4]):[3,7];case 2:return[2,o.sent()];case 3:return[3,6];case 4:return[4,this.isSegmentationValid(i,t)];case 5:if(!o.sent())return[2,!1];o.label=6;case 6:return r++,[3,1];case 7:return[2,!0]}}))}))},e.prototype.addLocationValuesToMap=function(e,t){c.SegmentOperatorValueEnum.COUNTRY in e&&(t[c.SegmentOperatorValueEnum.COUNTRY]=e[c.SegmentOperatorValueEnum.COUNTRY]),c.SegmentOperatorValueEnum.REGION in e&&(t[c.SegmentOperatorValueEnum.REGION]=e[c.SegmentOperatorValueEnum.REGION]),c.SegmentOperatorValueEnum.CITY in e&&(t[c.SegmentOperatorValueEnum.CITY]=e[c.SegmentOperatorValueEnum.CITY])},e.prototype.checkLocationPreSegmentation=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,s,u,c,l,g;return o(this,(function(o){return void 0===(null===(t=this.context)||void 0===t?void 0:t.getIpAddress())&&void 0!==process.env?(i.LogManager.Instance.error("To evaluate location pre Segment, please pass ipAddress in context object"),[2,!1]):(null===(r=null===(n=this.context)||void 0===n?void 0:n.getVwo())||void 0===r?void 0:r.getLocation())&&void 0!==(null===(s=null===(a=this.context)||void 0===a?void 0:a.getVwo())||void 0===s?void 0:s.getLocation())&&null!==(null===(c=null===(u=this.context)||void 0===u?void 0:u.getVwo())||void 0===c?void 0:c.getLocation())?[2,this.valuesMatch(e,null===(g=null===(l=this.context)||void 0===l?void 0:l.getVwo())||void 0===g?void 0:g.getLocation())]:[2,!1]}))}))},e.prototype.checkUserAgentParser=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,s,u,c,l;return o(this,(function(o){return(null===(t=this.context)||void 0===t?void 0:t.getUserAgent())&&void 0!==(null===(n=this.context)||void 0===n?void 0:n.getUserAgent())?(null===(a=null===(r=this.context)||void 0===r?void 0:r.getVwo())||void 0===a?void 0:a.getUaInfo())&&void 0!==(null===(u=null===(s=this.context)||void 0===s?void 0:s.getVwo())||void 0===u?void 0:u.getUaInfo())?[2,this.checkValuePresent(e,null===(l=null===(c=this.context)||void 0===c?void 0:c.getVwo())||void 0===l?void 0:l.getUaInfo())]:[2,!1]:(i.LogManager.Instance.error("To evaluate user agent related segments, please pass userAgent in context object"),[2,!1])}))}))},e.prototype.checkInUserStorage=function(e,t,n){return r(this,void 0,void 0,(function(){var e,r;return o(this,(function(o){switch(o.label){case 0:return e=new s.StorageService,[4,(new a.StorageDecorator).getFeatureFromStorage(t,n,e)];case 1:return r=o.sent(),(0,u.isObject)(r)&&Object.keys(r).length>0?[2,!0]:[2,!1]}}))}))},e.prototype.checkValuePresent=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a;return o(this,(function(o){for(r in n=function(n){if(Object.prototype.hasOwnProperty.call(e,n)){var r=e[n];r.forEach((function(e,t){r[t]=e.toLowerCase()}));for(var o=t[n],a=0,i=r;a<i.length;a++){var s=i[a];if(s.startsWith("wildcard(")&&s.endsWith(")")){var u=s.slice(9,-1);if(new RegExp(u.replace(/\*/g,".*"),"i").test(o))return{value:!0}}}if(r.includes(null==o?void 0:o.toLowerCase()))return{value:!0}}},t)if("object"==typeof(a=n(r)))return[2,a.value];return[2,!1]}))}))},e.prototype.valuesMatch=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a,i,s,u,c;return o(this,(function(o){for(n=0,r=Object.entries(e);n<r.length;n++){if(a=r[n],i=a[0],s=a[1],!(i in t))return[2,!1];if(u=this.normalizeValue(s),c=this.normalizeValue(t[i]),u!==c)return[2,!1]}return[2,!0]}))}))},e.prototype.normalizeValue=function(e){return null==e?null:e.toString().replace(/^"|"$/g,"").trim()},e}();t.SegmentEvaluator=p},7623:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.LogManager=void 0;var a=n(3903),i=n(5224),s=n(8671),u=n(1202),c=n(7173),l=n(8858),g=n(5076),p=function(e){function t(n){var r=e.call(this)||this;return r.name="VWO Logger",r.requestId=(0,a.v4)(),r.level=l.LogLevelEnum.ERROR,r.prefix="VWO-SDK",r.config=n,!n.isAlwaysNewInstance&&t.instance||(t.instance=r,r.config.name=n.name||r.name,r.config.requestId=n.requestId||r.requestId,r.config.level=n.level||r.level,r.config.prefix=n.prefix||r.prefix,r.config.dateTimeFormat=n.dateTimeFormat||r.dateTimeFormat,r.transportManager=new u.LogTransportManager(r.config),r.handleTransports()),t.instance}return o(t,e),t.prototype.dateTimeFormat=function(){return(new Date).toISOString()},Object.defineProperty(t,"Instance",{get:function(){return t.instance},enumerable:!1,configurable:!0}),t.prototype.handleTransports=function(){var e=this.config.transports;(null==e?void 0:e.length)?this.addTransports(this.config.transports):this.config.transport&&(0,c.isObject)(this.config.transport)?this.addTransport(this.config.transport):this.addTransport(new s.ConsoleTransport({level:this.config.level}))},t.prototype.addTransport=function(e){this.transportManager.addTransport(e)},t.prototype.addTransports=function(e){for(var t=0;t<e.length;t++)this.addTransport(e[t])},t.prototype.trace=function(e){this.transportManager.log(l.LogLevelEnum.TRACE,e)},t.prototype.debug=function(e){this.transportManager.log(l.LogLevelEnum.DEBUG,e)},t.prototype.info=function(e){this.transportManager.log(l.LogLevelEnum.INFO,e)},t.prototype.warn=function(e){this.transportManager.log(l.LogLevelEnum.WARN,e)},t.prototype.error=function(e,t){void 0===t&&(t=!0),this.transportManager.log(l.LogLevelEnum.ERROR,e),t&&(0,g.sendLogToVWO)(e,l.LogLevelEnum.ERROR)},t}(i.Logger);t.LogManager=p},7666:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalRequestModel=void 0;var n=function(){function e(e,t,n,r){this.timeout=3e3,this.url=e,this.query=t,this.body=n,this.headers=r}return e.prototype.setQuery=function(e){this.query=e},e.prototype.getQuery=function(){return this.query},e.prototype.setBody=function(e){this.body=e},e.prototype.getBody=function(){return this.body},e.prototype.setBaseUrl=function(e){this.url=e},e.prototype.getBaseUrl=function(){return this.url},e.prototype.setTimeout=function(e){this.timeout=e},e.prototype.getTimeout=function(){return this.timeout},e.prototype.setHeaders=function(e){this.headers=e},e.prototype.getHeaders=function(){return this.headers},e.prototype.setDevelopmentMode=function(e){this.isDevelopmentMode=e},e.prototype.getDevelopmentMode=function(){return this.isDevelopmentMode},e}();t.GlobalRequestModel=n},7788:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setSettingsAndAddCampaignsToRules=function(e,t){t.settings=new r.SettingsModel(e),t.originalSettings=e;var n=t.settings.getCampaigns();n.forEach((function(e,t){(0,o.setVariationAllocation)(e),n[t]=e})),(0,a.addLinkedCampaignsToSettings)(t.settings),(0,i.addIsGatewayServiceRequiredFlag)(t.settings)};var r=n(9540),o=n(5479),a=n(8470),i=n(596)},7846:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LogMessageBuilder=void 0;var r=n(8858),o="[1m",a="[0m",i=function(){function e(e,t){this.loggerConfig=e,this.transportConfig=t,this.prefix=this.transportConfig.prefix||this.loggerConfig.prefix||"",this.dateTimeFormat=this.transportConfig.dateTimeFormat||this.loggerConfig.dateTimeFormat}return e.prototype.formatMessage=function(e,t){return"[".concat(this.getFormattedLevel(e),"]: ").concat(this.getFormattedPrefix(this.prefix)," ").concat(this.getFormattedDateTime()," ").concat(t)},e.prototype.getFormattedPrefix=function(e){return this.loggerConfig.isAnsiColorEnabled?"".concat(o).concat("[32m").concat(e).concat(a):"".concat(e)},e.prototype.getFormattedLevel=function(e){var t,n,i,s=e.toUpperCase();return this.loggerConfig.isAnsiColorEnabled?((t={})[r.LogLevelEnum.TRACE]="".concat(o).concat("[30m").concat(s).concat(a),t[r.LogLevelEnum.DEBUG]="".concat(o).concat("[94m").concat(s).concat(a),t[r.LogLevelEnum.INFO]="".concat(o).concat("[36m").concat(s).concat(a),t[r.LogLevelEnum.WARN]="".concat(o).concat("[33m").concat(s).concat(a),t[r.LogLevelEnum.ERROR]="".concat(o).concat("[31m").concat(s).concat(a),i=t):((n={})[r.LogLevelEnum.TRACE]=s,n[r.LogLevelEnum.DEBUG]=s,n[r.LogLevelEnum.INFO]=s,n[r.LogLevelEnum.WARN]=s,n[r.LogLevelEnum.ERROR]=s,i=n),i[e]},e.prototype.getFormattedDateTime=function(){return this.dateTimeFormat()},e}();t.LogMessageBuilder=i},8198:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CampaignModel=void 0;var r=n(976),o=n(2160),a=n(1463),i=function(){function e(){this.variations=[],this.metrics=[],this.variables=[]}return e.prototype.copy=function(e){this.metrics=e.metrics,this.variations=e.variations,this.variables=e.variables,this.processCampaignKeys(e)},e.prototype.modelFromDictionary=function(e){return this.processCampaignProperties(e),this.processCampaignKeys(e),this},e.prototype.processCampaignProperties=function(e){var t=this;e.variables&&(e.variables.constructor==={}.constructor?this.variables=[]:e.variables.forEach((function(e){t.variables.push(o.VariableModel.modelFromDictionary(e))}))),e.variations&&(e.variations.constructor==={}.constructor?this.variations=[]:e.variations.forEach((function(e){t.variations.push((new a.VariationModel).modelFromDictionary(e))}))),e.metrics&&(e.metrics&&e.metrics.constructor==={}.constructor?this.metrics=[]:(e.metrics||[]).forEach((function(e){t.metrics.push((new r.MetricModel).modelFromDictionary(e))})))},e.prototype.processCampaignKeys=function(e){this.id=e.id,this.percentTraffic=e.percentTraffic,this.name=e.name,this.variationId=e.variationId,this.campaignId=e.campaignId,this.ruleKey=e.ruleKey,this.isForcedVariationEnabled=e.isForcedVariationEnabled,this.isUserListEnabled=e.isUserListEnabled,this.segments=e.segments,this.key=e.key,this.type=e.type,this.salt=e.salt},e.prototype.getId=function(){return this.id},e.prototype.getName=function(){return this.name},e.prototype.getSegments=function(){return this.segments},e.prototype.getTraffic=function(){return this.percentTraffic},e.prototype.getType=function(){return this.type},e.prototype.getIsForcedVariationEnabled=function(){return this.isForcedVariationEnabled},e.prototype.getIsUserListEnabled=function(){return this.isUserListEnabled},e.prototype.getKey=function(){return this.key},e.prototype.getMetrics=function(){return this.metrics},e.prototype.getVariations=function(){return this.variations},e.prototype.getVariables=function(){return this.variables},e.prototype.getRuleKey=function(){return this.ruleKey},e.prototype.getSalt=function(){return this.salt},e}();t.CampaignModel=i},8341:(e,t,n)=>{t.w=void 0;var r=n(1913),o=n(5576),a=n(3647),i=function(){function e(){}return e.prototype.GET=function(e){var t=new o.Deferred,n=e.getOptions(),i=new a.ResponseModel;return(0,r.sendGetCall)(n).then((function(e){i.setData(e),t.resolve(i)})).catch((function(e){i.setError(e),t.reject(i)})),t.promise},e.prototype.POST=function(e){var t=new o.Deferred,n=e.getOptions(),i=new a.ResponseModel;return(0,r.sendPostCall)(n).then((function(e){i.setData(e),t.resolve(i)})).catch((function(e){i.setError(e),t.reject(i)})),t.promise},e}();t.w=i},8470:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.cloneObject=function(e){return e?JSON.parse(JSON.stringify(e)):e},t.getCurrentTime=function(){return(new Date).toISOString()},t.getCurrentUnixTimestamp=function(){return Math.ceil(+new Date/1e3)},t.getCurrentUnixTimestampInMillis=function(){return+new Date},t.getRandomNumber=function(){return Math.random()},t.getSpecificRulesBasedOnType=function(e,t){return void 0===t&&(t=null),e&&!(null==e?void 0:e.getRulesLinkedCampaign())?[]:e&&e.getRulesLinkedCampaign()&&t&&(0,i.isString)(t)?e.getRulesLinkedCampaign().filter((function(e){return(new a.CampaignModel).modelFromDictionary(e).getType()===t})):e.getRulesLinkedCampaign()},t.getAllExperimentRules=function(e){return(null==e?void 0:e.getRulesLinkedCampaign().filter((function(e){return e.getType()===o.CampaignTypeEnum.AB||e.getType()===o.CampaignTypeEnum.PERSONALIZE})))||[]},t.getFeatureFromKey=function(e,t){var n;return null===(n=null==e?void 0:e.getFeatures())||void 0===n?void 0:n.find((function(e){return e.getKey()===t}))},t.doesEventBelongToAnyFeature=function(e,t){return t.getFeatures().some((function(t){return t.getMetrics().some((function(t){return t.getIdentifier()===e}))}))},t.addLinkedCampaignsToSettings=function(e){for(var t=new Map(e.getCampaigns().map((function(e){return[e.getId(),e]}))),n=0,o=e.getFeatures();n<o.length;n++){var i=o[n],s=i.getRules().map((function(e){var n=t.get(e.getCampaignId());if(!n)return null;var o=r(r({key:n.getKey()},n),{ruleKey:e.getRuleKey()});if(e.getVariationId()){var a=n.getVariations().find((function(t){return t.getId()===e.getVariationId()}));a&&(o.variations=[a])}return o})).filter((function(e){return null!==e})).map((function(e){var t=new a.CampaignModel;return t.modelFromDictionary(e),t}));i.setRulesLinkedCampaign(s)}};var o=n(6947),a=n(8198),i=n(7173)},8606:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContextModel=void 0;var r=n(3166),o=function(){function e(){}return e.prototype.modelFromDictionary=function(e){return this.id=e.id,this.userAgent=e.userAgent,this.ipAddress=e.ipAddress,void 0!==process.env||"undefined"==typeof XMLHttpRequest||e.userAgent||(this.userAgent=navigator.userAgent),(null==e?void 0:e.customVariables)&&(this.customVariables=e.customVariables),(null==e?void 0:e.variationTargetingVariables)&&(this.variationTargetingVariables=e.variationTargetingVariables),(null==e?void 0:e._vwo)&&(this._vwo=(new r.ContextVWOModel).modelFromDictionary(e._vwo)),this},e.prototype.getId=function(){var e;return null===(e=this.id)||void 0===e?void 0:e.toString()},e.prototype.getUserAgent=function(){return this.userAgent},e.prototype.getIpAddress=function(){return this.ipAddress},e.prototype.getCustomVariables=function(){return this.customVariables},e.prototype.setCustomVariables=function(e){this.customVariables=e},e.prototype.getVariationTargetingVariables=function(){return this.variationTargetingVariables},e.prototype.setVariationTargetingVariables=function(e){this.variationTargetingVariables=e},e.prototype.getVwo=function(){return this._vwo},e.prototype.setVwo=function(e){this._vwo=e},e}();t.ContextModel=o},8611:e=>{e.exports=require("http")},8671:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleTransport=void 0;var r=n(8858),o=function(){function e(e){void 0===e&&(e={}),this.config=e,this.level=this.config.level}return e.prototype.trace=function(e){this.consoleLog(r.LogLevelEnum.TRACE,e)},e.prototype.debug=function(e){this.consoleLog(r.LogLevelEnum.DEBUG,e)},e.prototype.info=function(e){this.consoleLog(r.LogLevelEnum.INFO,e)},e.prototype.warn=function(e){this.consoleLog(r.LogLevelEnum.WARN,e)},e.prototype.error=function(e){this.consoleLog(r.LogLevelEnum.ERROR,e)},e.prototype.consoleLog=function(e,t){console[e](t)},e}();t.ConsoleTransport=o},8858:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.LogLevelEnum=void 0,function(e){e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(n||(t.LogLevelEnum=n={}))},8996:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ImpactCapmaignModel=void 0;var n=function(){function e(){}return e.prototype.modelFromDictionary=function(e){return this.type=e.type,this.campaignId=e.campaignId,this},e.prototype.getCampaignId=function(){return this.campaignId},e.prototype.getType=function(){return this.type},e}();t.ImpactCapmaignModel=n},9227:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.SegmentOperandValueEnum=void 0,function(e){e[e.LOWER_VALUE=1]="LOWER_VALUE",e[e.STARTING_ENDING_STAR_VALUE=2]="STARTING_ENDING_STAR_VALUE",e[e.STARTING_STAR_VALUE=3]="STARTING_STAR_VALUE",e[e.ENDING_STAR_VALUE=4]="ENDING_STAR_VALUE",e[e.REGEX_VALUE=5]="REGEX_VALUE",e[e.EQUAL_VALUE=6]="EQUAL_VALUE",e[e.GREATER_THAN_VALUE=7]="GREATER_THAN_VALUE",e[e.GREATER_THAN_EQUAL_TO_VALUE=8]="GREATER_THAN_EQUAL_TO_VALUE",e[e.LESS_THAN_VALUE=9]="LESS_THAN_VALUE",e[e.LESS_THAN_EQUAL_TO_VALUE=10]="LESS_THAN_EQUAL_TO_VALUE"}(n||(t.SegmentOperandValueEnum=n={}))},9284:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.createAndSendImpressionForVariationShown=void 0;var a=n(1943),i=n(7111),s=n(5946);t.createAndSendImpressionForVariationShown=function(e,t,n,u){return r(void 0,void 0,void 0,(function(){var r,c;return o(this,(function(o){switch(o.label){case 0:return r=(0,a.getEventsBaseProperties)(i.EventEnum.VWO_VARIATION_SHOWN,encodeURIComponent(u.getUserAgent()),u.getIpAddress()),c=(0,a.getTrackUserPayloadData)(e,u.getId(),i.EventEnum.VWO_VARIATION_SHOWN,t,n,u.getUserAgent(),u.getIpAddress()),s.BatchEventsQueue.Instance?(s.BatchEventsQueue.Instance.enqueue(c),[3,3]):[3,1];case 1:return[4,(0,a.sendPostApiRequest)(r,c,u.getId())];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))}},9376:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Connector=void 0;t.Connector=function(){}},9455:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateTrafficAndGetVariation=t.checkWhitelistingAndPreSeg=void 0;var a=n(7173),i=n(6947),s=n(1155),u=n(2974),c=n(6365),l=n(6178),g=n(4988),p=n(3991),d=n(7173),f=n(477),h=n(5479),v=n(8470),m=n(5076),y=n(6254),E=n(4334),b=n(834);t.checkWhitelistingAndPreSeg=function(e,t,n,a,s,c,g,d){return r(void 0,void 0,void 0,(function(){var r,v,S,T,_,O,M,w;return o(this,(function(o){switch(o.label){case 0:return r=(0,E.getUUID)(a.getId(),e.getAccountId()),v=n.getId(),n.getType()!==i.CampaignTypeEnum.AB?[3,3]:(a.setVariationTargetingVariables(Object.assign({},a.getVariationTargetingVariables(),{_vwoUserId:n.getIsUserListEnabled()?r:a.getId()})),Object.assign(d,{variationTargetingVariables:a.getVariationTargetingVariables()}),n.getIsForcedVariationEnabled()?[4,I(n,a)]:[3,2]);case 1:return(S=o.sent())&&Object.keys(S).length>0?[2,[!0,S]]:[3,3];case 2:l.LogManager.Instance.info((0,m.buildMessage)(u.InfoLogMessagesEnum.WHITELISTING_SKIP,{campaignKey:n.getRuleKey(),userId:a.getId()})),o.label=3;case 3:if(a.setCustomVariables(Object.assign({},a.getCustomVariables(),{_vwoUserId:n.getIsUserListEnabled()?r:a.getId()})),Object.assign(d,{customVariables:a.getCustomVariables()}),T=(0,h.getGroupDetailsIfCampaignPartOfIt)(e,n.getId(),n.getType()===i.CampaignTypeEnum.PERSONALIZE?n.getVariations()[0].getId():null).groupId,!(_=null==c?void 0:c.get(T)))return[3,4];if(n.getType()===i.CampaignTypeEnum.AB){if(_===v)return[2,[!0,null]]}else if(n.getType()===i.CampaignTypeEnum.PERSONALIZE&&_===v+"_"+n.getVariations()[0].getId())return[2,[!0,null]];return[2,[!1,null]];case 4:return T?[4,(new b.StorageDecorator).getFeatureFromStorage("".concat(f.Constants.VWO_META_MEG_KEY).concat(T),a,g)]:[3,6];case 5:if((O=o.sent())&&O.experimentKey&&O.experimentId)return l.LogManager.Instance.info((0,m.buildMessage)(u.InfoLogMessagesEnum.MEG_CAMPAIGN_FOUND_IN_STORAGE,{campaignKey:O.experimentKey,userId:a.getId()})),O.experimentId===v?n.getType()===i.CampaignTypeEnum.PERSONALIZE?O.experimentVariationId===n.getVariations()[0].getId()?[2,[!0,null]]:(c.set(T,O.experimentId+"_"+O.experimentVariationId),[2,[!1,null]]):[2,[!0,null]]:(-1!=O.experimentVariationId?c.set(T,O.experimentId+"_"+O.experimentVariationId):c.set(T,O.experimentId),[2,[!1,null]]);o.label=6;case 6:return[4,(new p.CampaignDecisionService).getPreSegmentationDecision(n,a)];case 7:return(M=o.sent())&&T?[4,(0,y.evaluateGroups)(e,t,T,s,a,g)]:[3,9];case 8:return(w=o.sent())&&w.id===v?w.type===i.CampaignTypeEnum.AB||w.variations[0].id===n.getVariations()[0].getId()?[2,[!0,null]]:(c.set(T,w.id+"_"+w.variations[0].id),[2,[!1,null]]):w?(w.type===i.CampaignTypeEnum.AB?c.set(T,w.id):c.set(T,w.id+"_"+w.variations[0].id),[2,[!1,null]]):(c.set(T,-1),[2,[!1,null]]);case 9:return[2,[M,null]]}}))}))},t.evaluateTrafficAndGetVariation=function(e,t,n){var r=(new p.CampaignDecisionService).getVariationAlloted(n,e.getAccountId(),t);return r?(l.LogManager.Instance.info((0,m.buildMessage)(u.InfoLogMessagesEnum.USER_CAMPAIGN_BUCKET_INFO,{campaignKey:t.getType()===i.CampaignTypeEnum.AB?t.getKey():t.getName()+"_"+t.getRuleKey(),userId:n,status:"got variation:".concat(r.getKey())})),r):(l.LogManager.Instance.info((0,m.buildMessage)(u.InfoLogMessagesEnum.USER_CAMPAIGN_BUCKET_INFO,{campaignKey:t.getType()===i.CampaignTypeEnum.AB?t.getKey():t.getName()+"_"+t.getRuleKey(),userId:n,status:"did not get any variation"})),null)};var I=function(e,t){return r(void 0,void 0,void 0,(function(){var n,r,a;return o(this,(function(o){switch(o.label){case 0:return[4,S(e,t)];case 1:return n=o.sent(),r=n?s.StatusEnum.PASSED:s.StatusEnum.FAILED,a=n?n.variation.key:"",l.LogManager.Instance.info((0,m.buildMessage)(u.InfoLogMessagesEnum.WHITELISTING_STATUS,{userId:t.getId(),campaignKey:e.getType()===i.CampaignTypeEnum.AB?e.getKey():e.getName()+"_"+e.getRuleKey(),status:r,variationString:a})),[2,n]}}))}))},S=function(e,t){return r(void 0,void 0,void 0,(function(){var n,r,s,f,y,E;return o(this,(function(o){switch(o.label){case 0:return n=[],r=[],e.getVariations().forEach((function(o){if(!(0,d.isObject)(o.getSegments())||Object.keys(o.getSegments()).length){if((0,d.isObject)(o.getSegments())){var s=g.SegmentationManager.Instance.validateSegmentation(o.getSegments(),t.getVariationTargetingVariables());(s=(0,a.isPromise)(s)?s:Promise.resolve(s)).then((function(e){e&&n.push((0,v.cloneObject)(o))})),r.push(s)}}else l.LogManager.Instance.info((0,m.buildMessage)(u.InfoLogMessagesEnum.WHITELISTING_SKIP,{campaignKey:e.getType()===i.CampaignTypeEnum.AB?e.getKey():e.getName()+"_"+e.getRuleKey(),userId:t.getId(),variation:o.getKey()?"for variation: ".concat(o.getKey()):""}))})),[4,Promise.all(r)];case 1:if(o.sent(),n.length>1){for((0,h.scaleVariationWeights)(n),f=0,y=0,E=0;f<n.length;f++)E=(0,h.assignRangeValues)(n[f],y),y+=E;s=(new p.CampaignDecisionService).getVariation(n,(new c.DecisionMaker).calculateBucketValue((0,h.getBucketingSeed)(t.getId(),e,null)))}else s=n[0];return s?[2,{variation:s,variationName:s.name,variationId:s.id}]:[2]}}))}))}},9540:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsModel=void 0;var r=n(8198),o=n(9594),a=function(){function e(e){var t=this;return this.f=[],this.features=[],this.c=[],this.campaigns=[],this.campaignGroups={},this.cG={},this.groups={},this.g={},this.sdkKey=e.sK||e.sdkKey,this.accountId=e.a||e.accountId,this.version=e.v||e.version,this.collectionPrefix=e.collectionPrefix,(e.f&&e.f.constructor!=={}.constructor||e.features&&e.features.constructor!=={}.constructor)&&(e.f||e.features).forEach((function(e){t.features.push((new o.FeatureModel).modelFromDictionary(e))})),(e.c&&e.c.constructor!=={}.constructor||e.campaigns&&e.campaigns.constructor!=={}.constructor)&&(e.c||e.campaigns).forEach((function(e){t.campaigns.push((new r.CampaignModel).modelFromDictionary(e))})),(e.cG||e.campaignGroups)&&(this.campaignGroups=e.cG||e.campaignGroups),(e.g||e.groups)&&(this.groups=e.g||e.groups),this}return e.prototype.getFeatures=function(){return this.features},e.prototype.getCampaigns=function(){return this.campaigns},e.prototype.getSdkkey=function(){return this.sdkKey},e.prototype.getAccountId=function(){return this.accountId},e.prototype.getVersion=function(){return this.version},e.prototype.getCollectionPrefix=function(){return this.collectionPrefix},e.prototype.getCampaignGroups=function(){return this.campaignGroups},e.prototype.getGroups=function(){return this.groups},e}();t.SettingsModel=a},9594:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureModel=void 0;var r=n(8996),o=n(976),a=n(2258),i=function(){function e(){this.m=[],this.metrics=[],this.rules=[],this.impactCampaign=null,this.rulesLinkedCampaign=[],this.isGatewayServiceRequired=!1}return e.prototype.modelFromDictionary=function(e){var t,n,i,s=this;if(this.id=e.id,this.key=e.key,this.name=e.name,this.type=e.type,(null==e?void 0:e.isGatewayServiceRequired)&&(this.isGatewayServiceRequired=e.isGatewayServiceRequired),e.impactCampaign&&(this.impactCampaign=(new r.ImpactCapmaignModel).modelFromDictionary(e.impactCampaign)),e.m&&e.m.constructor==={}.constructor||(null===(t=e.metrics)||void 0===t?void 0:t.constructor)==={}.constructor)this.metrics=[];else{var u=e.m||e.metrics;null==u||u.forEach((function(e){s.metrics.push((new o.MetricModel).modelFromDictionary(e))}))}if((null===(n=null==e?void 0:e.rules)||void 0===n?void 0:n.constructor)==={}.constructor)this.rules=[];else{var c=e.rules;null==c||c.forEach((function(e){s.rules.push((new a.RuleModel).modelFromDictionary(e))}))}if((null==e?void 0:e.rulesLinkedCampaign)&&(null===(i=e.rulesLinkedCampaign)||void 0===i?void 0:i.constructor)!=={}.constructor){var l=e.rulesLinkedCampaign;this.rulesLinkedCampaign=l}return this},e.prototype.getName=function(){return this.name},e.prototype.getType=function(){return this.type},e.prototype.getId=function(){return this.id},e.prototype.getKey=function(){return this.key},e.prototype.getRules=function(){return this.rules},e.prototype.getImpactCampaign=function(){return this.impactCampaign},e.prototype.getRulesLinkedCampaign=function(){return this.rulesLinkedCampaign},e.prototype.setRulesLinkedCampaign=function(e){this.rulesLinkedCampaign=e},e.prototype.getMetrics=function(){return this.metrics},e.prototype.getIsGatewayServiceRequired=function(){return this.isGatewayServiceRequired},e.prototype.setIsGatewayServiceRequired=function(e){this.isGatewayServiceRequired=e},e}();t.FeatureModel=i},9600:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsService=void 0;var i=n(4059),s=n(6178),u=n(4464),c=n(5576),l=n(477),g=n(3388),p=n(5212),d=n(2974),f=n(5600),h=n(5076),v=n(1943),m=function(){function e(t){var n,r,o,a,i;if(this.isGatewayServiceProvided=!1,this.sdkKey=t.sdkKey,this.accountId=t.accountId,this.expiry=(null===(n=null==t?void 0:t.settings)||void 0===n?void 0:n.expiry)||l.Constants.SETTINGS_EXPIRY,this.networkTimeout=(null===(r=null==t?void 0:t.settings)||void 0===r?void 0:r.timeout)||l.Constants.SETTINGS_TIMEOUT,void 0===process.env&&"undefined"!=typeof XMLHttpRequest&&(this.isGatewayServiceProvided=!0),null===(o=null==t?void 0:t.gatewayService)||void 0===o?void 0:o.url){var u=void 0;this.isGatewayServiceProvided=!0,u=t.gatewayService.url.startsWith(g.HTTP_PROTOCOL)||t.gatewayService.url.startsWith(g.HTTPS_PROTOCOL)?new URL("".concat(t.gatewayService.url)):(null===(a=t.gatewayService)||void 0===a?void 0:a.protocol)?new URL("".concat(t.gatewayService.protocol,"://").concat(t.gatewayService.url)):new URL("".concat(g.HTTPS_PROTOCOL).concat(t.gatewayService.url)),this.hostname=u.hostname,this.protocol=u.protocol.replace(":",""),u.port?this.port=parseInt(u.port):(null===(i=t.gatewayService)||void 0===i?void 0:i.port)&&(this.port=t.gatewayService.port)}else this.hostname=l.Constants.HOST_NAME;s.LogManager.Instance.debug((0,h.buildMessage)(d.DebugLogMessagesEnum.SERVICE_INITIALIZED,{service:"Settings Manager"})),e.instance=this}return Object.defineProperty(e,"Instance",{get:function(){return e.instance},enumerable:!1,configurable:!0}),e.prototype.setSettingsExpiry=function(){var e=this,t=setTimeout((function(){e.fetchSettingsAndCacheInStorage().then((function(){clearTimeout(t),e.setSettingsExpiry()}))}),this.expiry)},e.prototype.normalizeSettings=function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){return(t=r({},e)).features&&0!==Object.keys(t.features).length||(t.features=[]),t.campaigns&&0!==Object.keys(t.campaigns).length||(t.campaigns=[]),[2,t]}))}))},e.prototype.handleBrowserEnvironment=function(e,t){return o(this,void 0,void 0,(function(){var n,r,o,i;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,6,,7]),[4,e.getSettingsFromStorage(this.sdkKey,this.accountId)];case 1:return(n=a.sent())?(s.LogManager.Instance.info((0,h.buildMessage)(d.InfoLogMessagesEnum.SETTINGS_FETCH_FROM_CACHE)),t.resolve(n)):s.LogManager.Instance.info((0,h.buildMessage)(d.InfoLogMessagesEnum.SETTINGS_CACHE_MISS)),[4,this.fetchSettings()];case 2:return r=a.sent(),[4,this.normalizeSettings(r)];case 3:return o=a.sent(),(new f.SettingsSchema).isSettingsValid(o)?[4,e.setSettingsInStorage(o)]:[3,5];case 4:a.sent(),a.label=5;case 5:return n?s.LogManager.Instance.info((0,h.buildMessage)(d.InfoLogMessagesEnum.SETTINGS_BACKGROUND_UPDATE)):(s.LogManager.Instance.info((0,h.buildMessage)(d.InfoLogMessagesEnum.SETTINGS_FETCH_SUCCESS)),t.resolve(o)),[3,7];case 6:return i=a.sent(),s.LogManager.Instance.error((0,h.buildMessage)(d.ErrorLogMessagesEnum.SETTINGS_FETCH_ERROR,{err:JSON.stringify(i)})),t.resolve(null),[3,7];case 7:return[2]}}))}))},e.prototype.handleServerEnvironment=function(e){return o(this,void 0,void 0,(function(){var t,n,r;return a(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,this.fetchSettings()];case 1:return t=o.sent(),[4,this.normalizeSettings(t)];case 2:return n=o.sent(),e.resolve(n),[3,4];case 3:return r=o.sent(),s.LogManager.Instance.error((0,h.buildMessage)(d.ErrorLogMessagesEnum.SETTINGS_FETCH_ERROR,{err:JSON.stringify(r)})),e.resolve(null),[3,4];case 4:return[2]}}))}))},e.prototype.fetchSettingsAndCacheInStorage=function(){var e=new c.Deferred,t=i.Storage.Instance.getConnector();return void 0===process.env&&"undefined"!=typeof XMLHttpRequest?this.handleBrowserEnvironment(t,e):this.handleServerEnvironment(e),e.promise},e.prototype.fetchSettings=function(e){void 0===e&&(e=!1);var t=new c.Deferred;this.sdkKey&&this.accountId||t.reject(new Error("sdkKey is required for fetching account settings. Aborting!"));var n=u.NetworkManager.Instance,r=(0,v.getSettingsPath)(this.sdkKey,this.accountId);r.platform=l.Constants.PLATFORM,r["api-version"]=l.Constants.API_VERSION,n.getConfig().getDevelopmentMode()||(r.s="prod");var o=l.Constants.SETTINTS_ENDPOINT;e&&(o=l.Constants.WEBHOOK_SETTINTS_ENDPOINT);try{var a=new u.RequestModel(this.hostname,p.HttpMethodEnum.GET,o,r,null,null,this.protocol,this.port);return a.setTimeout(this.networkTimeout),n.get(a).then((function(e){t.resolve(e.getData())})).catch((function(e){t.reject(e)})),t.promise}catch(e){return s.LogManager.Instance.error((0,h.buildMessage)(d.ErrorLogMessagesEnum.SETTINGS_FETCH_ERROR,{err:JSON.stringify(e)})),t.reject(e),t.promise}},e.prototype.getSettings=function(e){void 0===e&&(e=!1);var t=new c.Deferred;return e?this.fetchSettingsAndCacheInStorage().then((function(e){t.resolve(e)})):this.fetchSettingsAndCacheInStorage().then((function(e){(new f.SettingsSchema).isSettingsValid(e)?(s.LogManager.Instance.info(d.InfoLogMessagesEnum.SETTINGS_FETCH_SUCCESS),t.resolve(e)):(s.LogManager.Instance.error(d.ErrorLogMessagesEnum.SETTINGS_SCHEMA_INVALID),t.resolve({}))})),t.promise},e}();t.SettingsService=m},9708:e=>{e.exports=require("murmurhash")},9717:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RequestHandler=void 0;var n=function(){function e(){}return e.prototype.createRequest=function(e,t){if(!(null!==t.getBaseUrl()&&void 0!==t.getBaseUrl()||null!==e.getUrl()&&void 0!==e.getUrl()))return null;e.setUrl(e.getUrl()||t.getBaseUrl()),e.setTimeout(e.getTimeout()||t.getTimeout()),e.setBody(e.getBody()||t.getBody()),e.setHeaders(e.getHeaders()||t.getHeaders());var n=e.getQuery()||{},r=t.getQuery()||{};for(var o in r)Object.prototype.hasOwnProperty.call(n,o)||(n[o]=r[o]);return e.setQuery(n),e},e}();t.RequestHandler=n},9799:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.VWO=void 0,t.init=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a;return o(this,(function(o){t=g.ApiEnum.INIT,n=(new Date).toISOString();try{return(0,i.isObject)(e)||(a=(0,c.buildMessage)(u.ErrorLogMessagesEnum.INIT_OPTIONS_ERROR,{date:n}),console.error(a)),(null==e?void 0:e.sdkKey)&&(0,i.isString)(null==e?void 0:e.sdkKey)||(a=(0,c.buildMessage)(u.ErrorLogMessagesEnum.INIT_OPTIONS_SDK_KEY_ERROR,{date:n}),console.error(a)),e.accountId||(a=(0,c.buildMessage)(u.ErrorLogMessagesEnum.INIT_OPTIONS_ACCOUNT_ID_ERROR,{date:n}),console.error(a)),void 0===process.env?e.platform=l.PlatformEnum.CLIENT:e.platform=l.PlatformEnum.SERVER,r=new p(e),d={vwoInitDeferred:new s.Deferred,isSettingsFetched:!1,instance:null},[2,r.then((function(e){return d.isSettingsFetched=!0,d.instance=e,d.vwoInitDeferred.resolve(e),e}))]}catch(e){a=(0,c.buildMessage)(u.ErrorLogMessagesEnum.API_THROW_ERROR,{apiName:t,err:e}),console.info("[INFO]: VWO-SDK ".concat((new Date).toISOString()," ").concat(a))}return[2]}))}))},t.onInit=function(){return r(this,void 0,void 0,(function(){var e,t,n;return o(this,(function(r){e=g.ApiEnum.ON_INIT;try{return d.vwoInitDeferred=new s.Deferred,t=(new Date).toISOString(),d.isSettingsFetched?(n=(0,c.buildMessage)(u.InfoLogMessagesEnum.ON_INIT_ALREADY_RESOLVED,{date:t,apiName:e}),console.info(n),d.vwoInitDeferred.resolve(d.instance)):setTimeout((function(){if(!d.isSettingsFetched){var e=(0,c.buildMessage)(u.InfoLogMessagesEnum.ON_INIT_SETTINGS_FAILED,{date:t});console.error(e),d.vwoInitDeferred.reject(new Error("VWO settings could not be fetched"))}}),5e3),[2,d.vwoInitDeferred.promise]}catch(t){n=(0,c.buildMessage)(u.ErrorLogMessagesEnum.API_THROW_ERROR,{apiName:e,err:t}),console.info("[INFO]: VWO-SDK ".concat((new Date).toISOString()," ").concat(n))}return[2]}))}))};var a=n(2676),i=n(7173),s=n(5576),u=n(2974),c=n(5076),l=n(2550),g=n(6167),p=function(){function e(t){return e.setInstance(t)}return e.setInstance=function(e){var t=this,n=null==e?void 0:e.vwoBuilder;return this.vwoBuilder=n||new a.VWOBuilder(e),this.instance=this.vwoBuilder.setLogger().setSettingsService().setStorage().setNetworkManager().setSegmentation().initPolling().initBatching().initUsageStats(),(null==e?void 0:e.settings)?Promise.resolve(this.vwoBuilder.build(e.settings)):this.vwoBuilder.getSettings().then((function(e){return t.vwoBuilder.build(e)}))},Object.defineProperty(e,"Instance",{get:function(){return this.instance},enumerable:!1,configurable:!0}),e}();t.VWO=p;var d={}},9955:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.TrackApi=void 0;var a=n(6167),i=n(2974),s=n(6178),u=n(8470),c=n(5076),l=n(5946),g=n(1943),p=function(){function e(){}return e.prototype.track=function(e,t,n,l,p){return r(this,void 0,void 0,(function(){var r,f;return o(this,(function(o){switch(o.label){case 0:return(0,u.doesEventBelongToAnyFeature)(t,e)?(0,g.getShouldWaitForTrackingCalls)()?[4,d(e,t,n,l)]:[3,2]:[3,4];case 1:return o.sent(),[3,3];case 2:d(e,t,n,l),o.label=3;case 3:return p.set({eventName:t,api:a.ApiEnum.TRACK_EVENT}),p.execute(p.get()),[2,(r={},r[t]=!0,r)];case 4:return s.LogManager.Instance.error((0,c.buildMessage)(i.ErrorLogMessagesEnum.EVENT_NOT_FOUND,{eventName:t})),[2,(f={},f[t]=!1,f)]}}))}))},e}();t.TrackApi=p;var d=function(e,t,n,a){return r(void 0,void 0,void 0,(function(){var r,i;return o(this,(function(o){switch(o.label){case 0:return r=(0,g.getEventsBaseProperties)(t,encodeURIComponent(n.getUserAgent()),n.getIpAddress()),i=(0,g.getTrackGoalPayloadData)(e,n.getId(),t,a,null==n?void 0:n.getUserAgent(),null==n?void 0:n.getIpAddress()),l.BatchEventsQueue.Instance?(l.BatchEventsQueue.Instance.enqueue(i),[3,3]):[3,1];case 1:return[4,(0,g.sendPostApiRequest)(r,i,n.getId())];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}var r={};(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.Flag=e.StorageConnector=e.LogLevelEnum=e.onInit=e.init=void 0;var t=n(8858);Object.defineProperty(e,"LogLevelEnum",{enumerable:!0,get:function(){return t.LogLevelEnum}});var o=n(9376);Object.defineProperty(e,"StorageConnector",{enumerable:!0,get:function(){return o.Connector}});var a=n(3090);Object.defineProperty(e,"Flag",{enumerable:!0,get:function(){return a.Flag}});var i=n(9799);Object.defineProperty(e,"init",{enumerable:!0,get:function(){return i.init}}),Object.defineProperty(e,"onInit",{enumerable:!0,get:function(){return i.onInit}})})(),module.exports=r})();
//# sourceMappingURL=vwo-fme-node-sdk.min.js.map